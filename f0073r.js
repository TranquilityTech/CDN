const TQRTC=()=>{const e=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,t=(window.URL||window.webkitURL||window.msURL||window.oURL,navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),n=window.mozRTCIceCandidate||window.RTCIceCandidate,o=window.mozRTCSessionDescription||window.RTCSessionDescription,a=!!navigator.mozGetUserMedia,r={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"},{url:"stun:stunserver.org"}]};class i{constructor(){this.events={}}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}emit(e,t){let n,o,a=this.events[e],r=Array.prototype.slice.call(arguments,1);if(a)for(n=0,o=a.length;n<o;n++)a[n].apply(null,r)}}return new class extends i{constructor(){super(),this.room="",this.server="",this.localMediaStream=null,this.socket=null,this.me=null,this.peerConnections={},this.connections=[],this.numStreams=0,this.initializedStreams=0,this.dataChannels={}}connect(e,t){let o,a=this;function r(){o&&1===o.readyState&&(o.send(JSON.stringify({data:"heartbeat"})),setTimeout(r,3e4))}t=t||"",this.server=e,(o=this.socket=new WebSocket(e)).onopen=(()=>{o.send(JSON.stringify({eventName:"__join",data:{room:t}})),a.emit("socket_opened",o),r()}),o.onmessage=(e=>{let t=JSON.parse(e.data);t.eventName?a.emit(t.eventName,t.data):a.emit("socket_receive_message",o,t)}),o.onerror=(e=>{a.emit("socket_error",e,o)}),o.onclose=(()=>{let e=a.peerConnections;for(let t=e.length;t--;)a.closePeerConnection(e[t]);Object.values(e).forEach(e=>{a.closePeerConnection(e),e.close()}),a.peerConnections=[],a.dataChannels={},a.connections=[],a.emit("socket_closed",o),reconnectVideoChat()}),this.on("_peers",e=>{a.connections=e.connections,a.me=e.you,a.emit("get_peers",a.connections),a.emit("connected",o)}),this.on("_ice_candidate",e=>{let t=new n({sdpMLineIndex:e.label,candidate:e.candidate});a.peerConnections[e.socketId].addIceCandidate(t),a.emit("get_ice_candidate",t)}),this.on("_new_peer",e=>{a.connections.push(e.socketId),a.createPeerConnection(e.socketId).addStream(a.localMediaStream),a.emit("new_peer",e.socketId)}),this.on("_remove_peer",e=>{a.closePeerConnection(a.peerConnections[e.socketId]),delete a.peerConnections[e.socketId],delete a.dataChannels[e.socketId],a.emit("remove_peer",e.socketId)}),this.on("_offer",e=>{a.receiveOffer(e.socketId,e.sdp),a.emit("get_offer",e)}),this.on("_answer",e=>{a.receiveAnswer(e.socketId,e.sdp),a.emit("get_answer",e)}),this.on("ready",()=>{a.createPeerConnections(),a.addStreams(),a.addDataChannels(),a.sendOffers()})}createStream(e){let n=this;t?(this.numStreams++,async function(e){let t=null;try{t=await navigator.mediaDevices.getUserMedia(e),n.localMediaStream=t,n.initializedStreams++,n.emit("stream_created",t),n.initializedStreams===n.numStreams&&n.emit("ready")}catch(e){n.emit("stream_create_error",e)}}(e)):n.emit("stream_create_error",new Error("WebRTC is not yet supported in this browser."))}changeStream(e,t){let n;switch(t){case"video":n=e.getVideoTracks()[0];break;case"audio":n=e.getAudioTracks()[0];break;default:return}let o=this.peerConnections;Object.values(o).forEach(t=>{let o=t.getSenders().find(e=>e.track.kind===n.kind);e.getTracks().forEach(e=>o.replaceTrack(e))}),this.localMediaStream=e}addStreams(){for(let e in this.peerConnections)this.peerConnections[e].addStream(this.localMediaStream)}attachStream(e,t){let n=document.getElementById(t);if(a)n.mozSrcObject=e,n.play();else try{n.srcObject=e}catch(t){n.src=window.URL.createObjectURL(e)}}sendOffers(){let e,t=this,n=(e,n)=>o=>{e.setLocalDescription(o),t.socket.send(JSON.stringify({eventName:"__offer",data:{sdp:o,socketId:n}}))},o=e=>{if(e)throw e};for(let t=0,a=this.connections.length;t<a;t++)(e=this.peerConnections[this.connections[t]]).createOffer(n(e,this.connections[t]),o,{iceRestart:!0})}receiveOffer(e,t){this.peerConnections[e],this.sendAnswer(e,t)}sendAnswer(e,t){let n=this.peerConnections[e],a=this;n.setRemoteDescription(new o(t)),n.createAnswer(t=>{n.setLocalDescription(t),a.socket.send(JSON.stringify({eventName:"__answer",data:{socketId:e,sdp:t}}))},e=>{if(e)throw e})}receiveAnswer(e,t){this.peerConnections[e].setRemoteDescription(new o(t))}createPeerConnections(){for(let e=0,t=this.connections.length;e<t;e++)this.createPeerConnection(this.connections[e])}createPeerConnection(t){let n=this,o=new e(r);return this.peerConnections[t]=o,o.onicecandidate=(e=>{e.candidate&&n.socket.send(JSON.stringify({eventName:"__ice_candidate",data:{label:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate,socketId:t}})),n.emit("pc_get_ice_candidate",e.candidate,t,o)}),o.onopen=(()=>{n.emit("pc_opened",t,o)}),o.onaddstream=(e=>{n.emit("pc_add_stream",e.stream,t,o)}),o.ondatachannel=(e=>{n.addDataChannel(t,e.channel),n.emit("pc_add_data_channel",e.channel,t,o)}),o.oniceconnectionstatechange=(e=>{switch(o.iceConnectionState){case"new":case"checking":case"connected":break;case"failed":o.restartIce()}}),o}closePeerConnection(e){e&&e.close()}broadcast(e){for(let t in this.dataChannels)this.sendMessage(e,t)}sendMessage(e,t){"open"===this.dataChannels[t].readyState.toLowerCase()&&this.dataChannels[t].send(JSON.stringify({type:"__msg",data:e}))}changeMode(e){for(let t in this.dataChannels)"open"===this.dataChannels[t].readyState.toLowerCase()&&this.dataChannels[t].send(JSON.stringify({type:"changeMode",data:e}))}addDataChannels(){for(let e in this.peerConnections)this.createDataChannel(e)}createDataChannel(t,n){let o,a=this.peerConnections[t];t||this.emit("data_channel_create_error",t,new Error("attempt to create data channel without socket id")),a instanceof e||this.emit("data_channel_create_error",t,new Error("attempt to create data channel without peerConnection"));try{o=a.createDataChannel(n)}catch(e){this.emit("data_channel_create_error",t,e)}return this.addDataChannel(t,o)}addDataChannel(e,t){let n=this;return t.onopen=(()=>{n.emit("data_channel_opened",t,e)}),t.onclose=function(o){delete n.dataChannels[e],n.emit("data_channel_closed",t,e)},t.onmessage=function(o){let a=JSON.parse(o.data);switch(a.type){case"changeMode":n.emit("change_mode",e,a);break;default:n.emit("data_channel_message",t,e,a.data)}},t.onerror=(o=>{n.emit("data_channel_error",t,e,o)}),this.dataChannels[e]=t,t}close(){this.socket.close()}}};function checkDeviceSupport(e){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=(e=>{navigator.mediaDevices.enumerateDevices().then(e)}));let t=[],n="https:"===location.protocol,o=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?o=!0:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(o=!0);let a=!1,r=!1,i=!1,s=!1,c=!1;o&&(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?navigator.enumerateDevices(o=>{o.forEach(e=>{let o,l={};for(let t in e)l[t]=e[t];if("audio"===l.kind&&(l.kind="audioinput"),"video"===l.kind&&(l.kind="videoinput"),t.forEach(e=>{e.id===l.id&&e.kind===l.kind&&(o=!0)}),!o){switch(l.deviceId||(l.deviceId=l.id),l.id||(l.id=l.deviceId),l.label?("videoinput"!==l.kind||c||(c=!0),"audioinput"!==l.kind||s||(s=!0)):(l.label="Please invoke getUserMedia once.",n||(l.label="HTTPs is required to get label of this "+l.kind+" device.")),l.kind){case"audioinput":a=!0;break;case"audiooutput":r=!0;break;case"videoinput":i=!0}t.push(l)}}),e&&e(i,a,c,s)}):e&&e())}function createMeet(){let e=event.currentTarget.dataset.msg;document.querySelector("#messenger-wrapper").classList.remove("active"),document.querySelector("#messenger-cover").classList.remove("active"),$STATE.meet.isMeeting?showVideoChatForm():e&&fetch("/createMeet",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(t=>{if(200===t.status){let n=t.uid;document.querySelector("#meet").innerHTML=t.template,document.getElementById("videoChatCalling").classList.add("active");let o=document.querySelector("#video-chat-users-counter").innerText;document.querySelector("#video-chat-users-counter").innerText=Number(o)+1,$STATE.meet.room=n,$STATE.meet.isMeeting=!0,meetSocket.join({uid:n,name:null}),socket.emit("createMeet",{messenger:e,room:n}),connect(n),updateLayout(),tabReflash()}})}function joinMeetByName(e){event.currentTarget.querySelector("i.fa-lock")?Swal.fire({type:"error",title:"This room is locked",confirmButtonText:"Oops",background:"rgba(47, 47, 47, .75)"}):(document.querySelector("#messenger-wrapper")&&(document.querySelector("#messenger-wrapper").classList.remove("active"),document.querySelector("#messenger-cover").classList.remove("active")),$STATE.meet.isMeeting?showVideoChatForm():e&&(Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("/joinMeetByName",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({name:e})}).then(e=>e.json()).then(t=>{switch(Swal.close(),t.status){case 200:document.querySelector("#meet").innerHTML=t.template,document.getElementById("videoChatCalling").classList.add("active");let n=document.querySelector("#video-chat-users-counter").innerText;document.querySelector("#video-chat-users-counter").innerText=Number(n)+1,$STATE.meet.room=t.room,$STATE.meet.isMeeting=!0,meetSocket.join({uid:t.room,name:e}),connect(t.room),updateLayout(),tabReflash();break;case 403:Swal.fire({type:"error",title:"Oops...",text:"This room is locked!",background:"rgba(47, 47, 47, .8)"});break;default:Swal.fire({type:"error",title:"Oops...",text:"Something went wrong in this mode!",background:"rgba(47, 47, 47, .8)"})}})))}function enterMeet(){if("Enter"===event.key){let e=event.currentTarget.value;$STATE.isGuest&&($STATE.meet.avatar=`https://api.hello-avatar.com/adorables/${5e3*Math.random()|0}`),joinMeetByName(e)}}function joinMeetBySweetPop(){$STATE.meet.isMeeting?showVideoChatForm():swal({title:`${i18next.t("Create new room")}`,input:"text",inputPlaceholder:"room name",showCancelButton:!0,confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`,showLoaderOnConfirm:!0,background:"rgba(30, 30, 30, .8)"}).then(e=>{e.value&&joinMeetByName(e.value)})}function joinMeetByMessenger(){let e=event.currentTarget.dataset.room;e&&(document.querySelector("#messenger-wrapper")&&(document.querySelector("#messenger-wrapper").classList.remove("active"),document.querySelector("#messenger-cover").classList.remove("active")),$STATE.meet.isMeeting?showVideoChatForm():fetch("/joinMeetByUid",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({room:e})}).then(e=>e.json()).then(t=>{200===t.status&&(document.querySelector("#meet").innerHTML=t.template,document.getElementById("videoChatCalling").classList.add("active"),$STATE.meet.room=e,$STATE.meet.isMeeting=!0,meetSocket.join({uid:e,name:null}),connect(e),updateLayout(),tabReflash())}))}function updateLayout(){let e=document.getElementById("videoChatForm").dataset.fullscreen,t=document.querySelectorAll("#videoChatVideos .videoContainer").length;if("true"===e)switch(document.querySelector("#videoChatForm .main").style.height="99vh",document.getElementById("videoChatMessenger").style.height="100vh",document.querySelector("#videoChatMessenger .videoChatInput-container").style.height="16%",document.querySelector("#videoChatMessenger .content").style.height="99vh",document.querySelectorAll("#videoChatVideos .options button").forEach(e=>e.style.cssText="top: 7vh"),t){case 1:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr; grid-template-rows: 99vh; grid-auto-flow: column dense;",document.querySelectorAll("#videoChatVideos .videoContainer").forEach(e=>e.style.cssText="height: 99vh"),document.querySelectorAll('#videoChatVideos .videoContainer button[name="pin"]').forEach(e=>e.classList.add("hidden"));break;case 2:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr 1fr; grid-template-rows: 99vh;",document.querySelectorAll("#videoChatVideos .videoContainer").forEach(e=>e.style.cssText="height: 99vh"),document.querySelectorAll('#videoChatVideos .videoContainer button[name="pin"]').forEach(e=>e.classList.remove("hidden"));break;default:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr 1fr; grid-template-rows: 49vh;",document.querySelectorAll("#videoChatVideos .videoContainer").forEach(e=>{e.classList.contains("pin")?e.style.cssText="height: 99vh":e.style.cssText="height: 49vh"}),document.querySelectorAll('#videoChatVideos .videoContainer button[name="pin"]').forEach(e=>e.classList.remove("hidden"))}else switch(document.querySelector("#videoChatForm .main").style.height="92.5vh",document.getElementById("videoChatMessenger").style.height="92.5vh",document.querySelector("#videoChatMessenger .content").style.height="92.5vh",document.querySelector("#videoChatMessenger .videoChatInput-container").style.height="15%",document.querySelectorAll("#videoChatVideos .options button").forEach(e=>e.style.cssText="top: 4vh"),t){case 1:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr; grid-template-rows: 92.5vh; grid-auto-flow: column dense;",document.querySelectorAll("#videoChatVideos .videoContainer").forEach(e=>e.style.cssText="height: 92.5vh"),document.querySelectorAll('#videoChatVideos .videoContainer button[name="pin"]').forEach(e=>e.classList.add("hidden"));break;case 2:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr 1fr; grid-template-rows: 92.5vh;",document.querySelectorAll("#videoChatVideos .videoContainer").forEach(e=>e.style.cssText="height: 92.5vh"),document.querySelectorAll('#videoChatVideos .videoContainer button[name="pin"]').forEach(e=>e.classList.remove("hidden"));break;default:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr 1fr; grid-template-rows: 46vh;",document.querySelectorAll("#videoChatVideos .videoContainer").forEach(e=>{e.classList.contains("pin")?e.style.cssText="height: 92vh":e.style.cssText="height: 46vh"}),document.querySelectorAll('#videoChatVideos .videoContainer button[name="pin"]').forEach(e=>e.classList.remove("hidden"))}new Sortable(document.querySelector("#videoChatVideos"),{handle:".videoContainer",animation:500})}function pinVideo(){let e=document.getElementById("videoChatForm").dataset.fullscreen,t=document.querySelectorAll("#videoChatVideos .videoContainer").length;if(event.currentTarget.closest(".videoContainer").classList.contains("pin")){if("true"===e)switch(t){case 1:case 2:event.currentTarget.closest(".videoContainer").style.cssText="height: 99vh";break;default:event.currentTarget.closest(".videoContainer").style.cssText="height: 48vh"}else switch(t){case 1:case 2:event.currentTarget.closest(".videoContainer").style.cssText="height: 92.5vh";break;default:event.currentTarget.closest(".videoContainer").style.cssText="height: 100%"}document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr 1fr",event.currentTarget.closest(".videoContainer").classList.remove("pin"),event.currentTarget.classList.remove("pinned")}else{document.querySelectorAll("#videoChatVideos .videoContainer").forEach(n=>{if(n.classList.contains("pin")&&n.classList.remove("pin"),n.querySelector('button[name="pin"]').classList.contains("pinned")&&n.querySelector('button[name="pin"]').classList.remove("pinned"),"true"===e)switch(t){case 1:case 2:n.style.cssText="height: 99vh";break;default:n.style.cssText="height: 48vh"}else switch(t){case 1:case 2:n.style.cssText="height: 92.5vh";break;default:n.style.cssText="height: 100%"}}),document.querySelector("#videoChatVideos span.pinned")&&document.querySelector("#videoChatVideos span.pinned").classList.remove("pinned"),event.currentTarget.classList.add("pinned");let n=document.querySelector("#videoChatVideos");switch(n.insertBefore(event.currentTarget.closest(".videoContainer"),n.childNodes[0]),event.currentTarget.closest(".videoContainer").style.cssText="true"===e?"height: 99vh":"height: 92.5vh",event.currentTarget.closest(".videoContainer").classList.add("pin"),t){case 1:case 2:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr";break;default:document.querySelector("#videoChatVideos").style.cssText="grid-template-columns: 1fr 1fr"}}let n=document.querySelector("#videoChatVideos").offsetTop;document.querySelector("#videoChatVideos").scrollTop=n}function videoChatFullscreen(){let e=document.getElementById("videoChatForm");"true"===document.getElementById("videoChatForm").dataset.fullscreen?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),document.getElementById("videoChatForm").dataset.fullscreen="false",document.querySelector('#videoChatForm button[name="fullscreen"] i').classList.replace("fa-compress","fa-expand")):(e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.getElementById("videoChatForm").dataset.fullscreen="true",document.querySelector('#videoChatForm button[name="fullscreen"] i').classList.replace("fa-expand","fa-compress")),updateLayout()}function videoChatMessengerToggle(){"true"===event.currentTarget.dataset.isopen?(document.getElementById("videoChatMessenger").classList.add("close"),event.currentTarget.dataset.isopen="false"):(document.getElementById("videoChatMessenger").classList.remove("close"),event.currentTarget.dataset.isopen="true"),delete document.querySelector('#videoChatForm button[name="comment"]').dataset.count}function sendVideoChatMsg(e,t){if(13==(e.which||e.keyCode)&&!e.shiftKey){e.preventDefault();let t=document.getElementById("videoChatInput"),n=t.innerHTML,o=DOMPurify.sanitize(`${n}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br"],FORBID_ATTR:["style"]});if(o){rtc.broadcast({msg:o,name:`${$STATE.user.nickname||$STATE.user.name}`,avatar:`/images/UserAlbum/${$STATE.userDefaultAlbums.avatar}/${$STATE.user.avatar}`}),t.innerHTML="",document.querySelector("#videoChatMessenger .content-container .chat-thread").insertAdjacentHTML("beforeend",`\n                <li class="message-personal">${o}</li>\n            `),scrollToDown(document.querySelector("#videoChatMessenger .content-container"))}}}function videoChatPicInPic(){if("pictureInPictureEnabled"in document)try{let e=event.currentTarget.closest(".videoContainer").querySelector("video");document.pictureInPictureElement?document.exitPictureInPicture():e.requestPictureInPicture()}catch(e){Swal.fire({type:"error",title:"Oops...",text:"Something went wrong in this mode!",background:"rgba(47, 47, 47, .8)"})}else Swal.fire({type:"error",title:"Oops...",text:"Your browser does not support picture in picture mode!",background:"rgba(47, 47, 47, .8)"})}let rtc,mediaStream,blurBackgroundStream,screenShareCaptureStream,connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection,recognizing=!1;function updateConnectionStatus(){if(connection){const{rtt:e,downlink:t,effectiveType:n,saveData:o}=connection;stat={rtt:e,downlink:t,effectiveType:n,saveData:o};for(let e in stat)stat.hasOwnProperty(e)&&(document.querySelector(`#video-chat-setting-stat-connection-${e}`).innerHTML="downlink"===e?`${stat[e]} Mbps`:stat[e])}}function addVideoChatDevice(e){let t,n=document.createElement("option");switch(e.kind){case"audioinput":t=document.querySelector("#video-chat-setting-general select[name='audioinput']");break;case"audiooutput":t=document.querySelector("#video-chat-setting-general select[name='audiooutput']");break;case"videoinput":t=document.querySelector("#video-chat-setting-general select[name='videoinput']")}n.text=e.label,n.value=e.deviceId,t&&n&&t.add(n)}function connect(e){rtc=TQRTC();document.getElementById("videoChatVideos"),document.querySelector("#videoChatForm .content-container .chat-thread");document.getElementById("myVideoChatVideo").dataset.mode="webcam",rtc.on("connected",e=>{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(e=>{checkDeviceSupport((e,t,n,o)=>{rtc.createStream({video:e,audio:t})}),updateConnectionStatus(),connection&&connection.addEventListener("change",updateConnectionStatus),e.forEach(e=>addVideoChatDevice(e))}):Swal.fire({type:"error",title:"Oops...",text:"Something went wrong!",background:"rgba(47, 47, 47, .8)"})}),rtc.on("stream_created",e=>{mediaStream=new MediaStream(e),document.getElementById("myVideoChatVideo").srcObject=mediaStream,streamAudioAnalyser(document.getElementById("myVideoChatVideo"),mediaStream),setTimeout(()=>{let e=`${$STATE.user.nickname||$STATE.user.name}`;meetSocket.sendMyName(rtc.me,e)},1e3)}),rtc.on("stream_create_error",()=>{alert("create stream failed!")}),rtc.on("pc_add_stream",(e,t)=>{let n=`other-${t}`,o=document.querySelector("#video-chat-users-counter").innerText;document.querySelector("#video-chat-users-counter").innerText=Number(o)+1,document.querySelector("#videoChatVideos").insertAdjacentHTML("beforeend",`\n            <div class="videoContainer">\n                <span class="recording hidden"><i class="fas fa-video"></i></span>\n                <span class="name"></span>\n                <span class="muted hidden"><i class="fas fa-microphone-slash"></i></span>\n\n                <video id="${n}" class="other" autoplay controlsList="nodownload" data-mode="webcam"></video>\n\n                <div class="videoChatVideoOption">\n                    <button type="button" name="muted" onclick="videoChatAudioToggle(this)">\n                        <i class="fas fa-microphone"></i>\n                        <span class="tooltip-bottom">${i18next.t("Muted")}</span>\n                    </button>\n                    <button type="button" name="record" onclick="videoChatRecorder()">\n                        <i class="fas fa-record-vinyl"></i>\n                        <span class="tooltip-bottom">${i18next.t("Recorder")}</span>\n                    </button>\n                    <button type="button" name="picInPic" onclick="videoChatPicInPic(this)">\n                        <i class="fas fa-border-style"></i>\n                        <span class="tooltip-bottom">${i18next.t("Picture in picture")}</span>\n                    </button>\n                    <button type="button" name="pin" onclick="pinVideo(this)">\n                        <i class="fas fa-thumbtack" data-fa-transform="rotate-180"></i>\n                        <span class="tooltip-bottom">${i18next.t("Pin")}</span>\n                    </button>\n                </div>\n            </div>\n        `),updateLayout(),rtc.attachStream(e,n),streamAudioAnalyser(document.getElementById(n),e)}),rtc.on("change_mode",(e,t)=>{document.querySelector(`#other-${e}`).dataset.mode=t.data}),rtc.on("remove_peer",e=>{let t=document.getElementById(`other-${e}`);if(t){let e=document.querySelector("#video-chat-users-counter").innerText;document.querySelector("#video-chat-users-counter").innerText=Number(e)-1,t.closest(".videoContainer").remove(),updateLayout()}}),rtc.connect("wss://tqwss.herokuapp.com/",e)}function showVideoChatForm(){document.getElementById("videoChatForm").classList.add("active")}async function screenShare(){try{screenShareCaptureStream=await navigator.mediaDevices.getDisplayMedia(),document.getElementById("myVideoChatVideo").srcObject=new MediaStream(screenShareCaptureStream),document.getElementById("myVideoChatVideo").dataset.mode="screen",rtc.changeStream(screenShareCaptureStream,"video"),rtc.changeMode("screen"),streamAudioAnalyser(document.getElementById("myVideoChatVideo"),screenShareCaptureStream),screenShareCaptureStream.getTracks()[0].onended=(()=>{rtc.changeStream(mediaStream,"video"),rtc.changeMode("webcam"),document.getElementById("myVideoChatVideo").srcObject=new MediaStream(mediaStream),document.getElementById("myVideoChatVideo").dataset.mode="webcam",streamAudioAnalyser(document.getElementById("myVideoChatVideo"),mediaStream),screenShareCaptureStream.getTracks().forEach(e=>e.stop())})}catch(e){console.error("Error: "+e)}}function videoChatAudioToggle(){event.currentTarget.closest(".videoContainer").querySelector("video").muted?(event.currentTarget.closest(".videoContainer").querySelector("video").muted=!1,event.currentTarget.querySelector("i").classList.replace("fa-microphone-slash","fa-microphone"),event.currentTarget.closest(".videoContainer").querySelector("span.muted").classList.add("hidden")):(event.currentTarget.closest(".videoContainer").querySelector("video").muted=!0,event.currentTarget.querySelector("i").classList.replace("fa-microphone","fa-microphone-slash"),event.currentTarget.closest(".videoContainer").querySelector("span.muted").classList.remove("hidden"))}function videoChatAllVolumeToggle(){if("INPUT"!==event.target.tagName){event.currentTarget.querySelector("i").classList.contains("fa-volume-up")?(event.currentTarget.querySelector("i").classList.replace("fa-volume-up","fa-volume-mute"),document.querySelectorAll("#videoChatVideos .videoContainer video").forEach(e=>{"myVideoChatVideo"!==e.id&&(e.muted=!0,e.closest(".videoContainer").querySelector("span.muted").classList.remove("hidden"),e.closest(".videoContainer").querySelector('button[name="muted"] i').classList.replace("fa-microphone","fa-microphone-slash"))}),event.currentTarget.querySelector('input[type="range"]').value=0,document.getElementById("videoChatAllVolume").dataset.percentage="Muted",document.querySelector("#videoChatAllVolume .progress-circle__bar").style.strokeDashoffset="565.4866776462px"):(event.currentTarget.querySelector("i").classList.replace("fa-volume-mute","fa-volume-up"),document.querySelectorAll("#videoChatVideos .videoContainer video").forEach(e=>{"myVideoChatVideo"!==e.id&&(e.muted=!1,e.closest(".videoContainer").querySelector("span.muted").classList.add("hidden"),e.closest(".videoContainer").querySelector('button[name="muted"] i').classList.replace("fa-microphone-slash","fa-microphone"))}),event.currentTarget.querySelector('input[type="range"]').value=100,document.getElementById("videoChatAllVolume").dataset.percentage=100,document.querySelector("#videoChatAllVolume .progress-circle__bar").style.strokeDashoffset="0px")}}function showVideoChatAllVolumePercentage(){document.getElementById("videoChatAllVolume").style.opacity=1,document.getElementById("videoChatAllVolume").classList.remove("hidden")}function hideVideoChatAllVolumePercentage(){document.getElementById("videoChatAllVolume").style.opacity=0,document.getElementById("videoChatAllVolume").classList.add("hidden")}function videoChatChangeVolume(){let e=event.currentTarget.value,t=document.getElementById("videoChatAllVolume").querySelectorAll(".progress-circle__bar")[0];isNaN(e)?(e=0,document.getElementById("videoChatAllVolume").dataset.percentage="Null"):(e<0&&(e=0),e>100&&(e=100),t.style.strokeDashoffset=(100-e)/100*Math.PI*(2*t.getAttribute("r")),0===e?(document.getElementById("videoChatAllVolume").dataset.percentage="Muted",document.querySelectorAll("#videoChatVideos .videoContainer video").forEach(e=>{"myVideoChatVideo"!==e.id&&(e.muted=!0,e.closest(".videoContainer").querySelector("span.muted").classList.remove("hidden"),e.closest(".videoContainer").querySelector('button[name="muted"] i').classList.replace("fa-microphone","fa-microphone-slash"))})):(document.getElementById("videoChatAllVolume").dataset.percentage=e,document.querySelectorAll("#videoChatVideos .videoContainer video").forEach(t=>{"myVideoChatVideo"!==t.id&&(t.muted=!1,t.volume=e/100,t.closest(".videoContainer").querySelector("span.muted").classList.add("hidden"),t.closest(".videoContainer").querySelector('button[name="muted"] i').classList.replace("fa-microphone-slash","fa-microphone"))}))),"0"===e?event.currentTarget.closest('button[name="speaker"]').querySelector("i").classList.contains("fa-volume-up")&&event.currentTarget.closest('button[name="speaker"]').querySelector("i").classList.replace("fa-volume-up","fa-volume-mute"):event.currentTarget.closest('button[name="speaker"]').querySelector("i").classList.contains("fa-volume-mute")&&event.currentTarget.closest('button[name="speaker"]').querySelector("i").classList.replace("fa-volume-mute","fa-volume-up")}function videoChatMyVideoToggle(){let e=event.currentTarget,t=e.querySelector("i").classList.contains("fa-video");if(t)mediaStream&&mediaStream.getTracks().forEach(e=>{"live"===e.readyState&&"video"===e.kind&&e.stop()}),rtc.changeStream(mediaStream,"video"),e.querySelector("i").classList.replace("fa-video","fa-video-slash");else try{checkDeviceSupport(async(t,n,o,a)=>{let r=mediaStream.getAudioTracks(),i={video:t,audio:Boolean(r.length)};mediaStream=await navigator.mediaDevices.getUserMedia(i),document.getElementById("myVideoChatVideo").srcObject=new MediaStream(mediaStream),document.getElementById("myVideoChatVideo").dataset.mode="webcam",rtc.changeStream(mediaStream,"video"),rtc.changeMode("webcam"),streamAudioAnalyser(document.getElementById("myVideoChatVideo"),mediaStream),e.querySelector("i").classList.replace("fa-video-slash","fa-video")})}catch(e){console.error("Error: "+e)}}function videoChatMyAudioToggle(){let e=event.currentTarget;if(e.querySelector("i").classList.contains("fa-microphone"))mediaStream&&mediaStream.getTracks().forEach(e=>{"live"===e.readyState&&"audio"===e.kind&&e.stop()}),rtc.changeStream(mediaStream,"audio"),e.querySelector("i.fa-microphone").classList.replace("fa-microphone","fa-microphone-slash");else try{checkDeviceSupport(async(t,n,o,a)=>{let r=mediaStream.getVideoTracks(),i={video:Boolean(r.length),audio:n};mediaStream=await navigator.mediaDevices.getUserMedia(i),document.getElementById("myVideoChatVideo").srcObject=new MediaStream(mediaStream),rtc.changeStream(mediaStream,"audio"),streamAudioAnalyser(document.getElementById("myVideoChatVideo"),mediaStream),e.querySelector("i.fa-microphone-slash").classList.replace("fa-microphone-slash","fa-microphone")})}catch(e){console.error("Error: "+e)}}let backgroundMusicStream,tempMediaStream,mediaRecorder,videoChatBackgroundMusic=document.getElementById("player");function videoChatBGM(){if($STATE.meet.isMeeting){let e=event.currentTarget.classList.contains("fa-pause");if(tempMediaStream&&tempMediaStream.getTracks().forEach(e=>e.stop()),e)try{checkDeviceSupport(async(e,t,n,o)=>{backgroundMusicStream&&backgroundMusicStream.getTracks().forEach(e=>e.stop());let a=mediaStream.getVideoTracks(),r=mediaStream.getAudioTracks(),i={video:Boolean(a.length),audio:Boolean(r.length)};mediaStream=await navigator.mediaDevices.getUserMedia(i),rtc.changeStream(mediaStream,"audio")})}catch(e){console.error("Error: "+e)}else try{checkDeviceSupport(async(e,t,n,o)=>{backgroundMusicStream=videoChatBackgroundMusic.captureStream();let a=mediaStream.getVideoTracks(),r=mediaStream.getAudioTracks(),i={video:Boolean(a.length),audio:Boolean(r.length)};tempMediaStream=await navigator.mediaDevices.getUserMedia(i),backgroundMusicStream.getTracks().forEach(e=>{"live"===e.readyState&&"audio"===e.kind&&tempMediaStream.addTrack(e)}),rtc.changeStream(tempMediaStream,"audio")})}catch(e){console.error("Error: "+e)}}}function closeVideoChat(){document.getElementById("myVideoChatVideo").srcObject=null,document.getElementById("myVideoChatVideo").pause();document.querySelector("#video-chat-users-counter").innerText=0;mediaStream&&mediaStream.getTracks().forEach(e=>e.stop()),screenShareCaptureStream&&screenShareCaptureStream.getTracks().forEach(e=>e.stop()),backgroundMusicStream&&backgroundMusicStream.getTracks().forEach(e=>e.stop()),tempMediaStream&&tempMediaStream.getTracks().forEach(e=>e.stop()),blurBackgroundStream&&blurBackgroundStream.getTracks().forEach(e=>e.stop()),document.getElementById("videoChatForm").classList.remove("active"),document.getElementById("videoChatCalling").classList.remove("active"),document.querySelectorAll(".videoContainer .other").forEach(e=>e.closest(".videoContainer").remove()),document.querySelectorAll("#video-chat-setting-general select[name='audioinput'] option, #video-chat-setting-general select[name='audiooutput'] option, #video-chat-setting-general select[name='videoinput'] option").forEach(e=>e.remove()),document.querySelector("#videoChatMessenger ul.chat-thread").innerHTML="","true"===document.getElementById("videoChatForm").dataset.fullscreen&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),document.getElementById("videoChatForm").dataset.fullscreen="false",document.querySelector('#videoChatForm button[name="fullscreen"] i').classList.add("fa-expand"),document.querySelector('#videoChatForm button[name="fullscreen"] i').classList.remove("fa-compress")),meetSocket.close(),rtc.close(),askSatisfaction(),$STATE.meet.room="",$STATE.meet.isMeeting=!1,updateLayout()}function reconnectVideoChat(){if($STATE.meet.isMeeting){$STATE.meet.room;document.querySelectorAll(".videoContainer .other").forEach(e=>e.closest(".videoContainer").remove()),updateLayout(),connect($STATE.meet.room)}}function streamAudioAnalyser(e,t){let n=t.getTracks().find(e=>"audio"===e.kind);if(n){let o=new AudioContext,a=o.createMediaStreamSource(t),r=o.createAnalyser();javascriptNode=o.createScriptProcessor(2048,1,1),r.smoothingTimeConstant=.1,r.fftSize=1024,a.connect(r),r.connect(javascriptNode),javascriptNode.connect(o.destination),javascriptNode.onaudioprocess=(()=>{let t=new Uint8Array(r.frequencyBinCount);r.getByteFrequencyData(t);let n=0,o=t.length;for(let e=0;e<o;e++)n+=t[e];n/o>5?e.closest(".videoContainer").classList.add("isSpeaking"):e.closest(".videoContainer").classList.remove("isSpeaking")});let i=setInterval(()=>{"live"!==n.readyState&&(o.close(),clearTimeout(i))},1e3)}}let recordedBlobs=[];async function videoChatRecorder(){let e=event.currentTarget;if(e.querySelector("i").classList.contains("fa-stop")){e.querySelector("i").classList.replace("fa-stop","fa-record-vinyl"),download(new Blob(recordedBlobs,{type:"video/webm"}),"TQ Meet"),mediaRecorder.stop()}else{e.querySelector("i").classList.replace("fa-record-vinyl","fa-stop");let t={mimeType:"video/webm;codecs=vp9,opus"};MediaRecorder.isTypeSupported(t.mimeType)?MediaRecorder.isTypeSupported(t.mimeType)?MediaRecorder.isTypeSupported(t.mimeType)||(t={mimeType:""}):t={mimeType:"video/webm"}:t={mimeType:"video/webm;codecs=vp8,opus"};try{let n=e.closest(".videoContainer").querySelector("video").captureStream();mediaRecorder=new MediaRecorder(n,t),e.closest(".videoContainer").querySelector("span.recording").classList.remove("hidden"),mediaRecorder.addEventListener("dataavailable",e=>{e.data.size>0&&"recording"===mediaRecorder.state&&recordedBlobs.push(e.data)}),mediaRecorder.addEventListener("stop",()=>{recordedBlobs=[],e.closest(".videoContainer").querySelector("span.recording").classList.add("hidden")}),mediaRecorder.start(1e3)}catch(t){if(t)throw t;return void e.closest(".videoContainer").querySelector("span.recording").classList.add("hidden")}}}function videoChatScreenshot(){let e=event.currentTarget.closest(".videoContainer").querySelector("video"),t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;let n=t.getContext("2d");n.translate(t.width,0),n.scale(-1,1),n.drawImage(e,0,0,t.width,t.height);let o=t.toDataURL("image/png",1);fetch("/uploadBase64",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({base64image:o})})}function videoChatLockRoom(){let e=document.querySelector("#videoChatRoomId").innerText,t=event.currentTarget.classList.contains("on")?0:1;e&&(meetSocket.lockRoom({uid:e,status:t}),t?event.currentTarget.classList.add("on"):event.currentTarget.classList.remove("on"))}function blurBackground(){let e=event.currentTarget;if("false"===e.dataset.bluring){let t,n;document.getElementById("tempMyVideoChatVideo")?(t=document.getElementById("tempMyVideoChatVideo"),n=document.getElementById("myVideoChatVideoCanvas")):((t=document.createElement("video")).id="tempMyVideoChatVideo",t.height=mediaStream.getVideoTracks()[0].getSettings().height,t.width=mediaStream.getVideoTracks()[0].getSettings().width,t.autoplay=!0,t.srcObject=mediaStream,t.onplaying=(()=>{n.height=t.videoHeight,n.width=t.videoWidth}),t.load(),t.addEventListener("loadeddata",()=>{bodyPix.load({architecture:"MobileNetV1",multiplier:.5,outputStride:16,quantBytes:2}).then(o=>(async function(o){for(;"true"===e.dataset.bluring;){const e=await o.segmentPerson(t),a=3,r=1,i=!1;bodyPix.drawBokehEffect(n,t,e,a,r,i)}})(o)).catch(e=>{if(e)throw e}),blurBackgroundStream=n.captureStream(),document.getElementById("myVideoChatVideo").srcObject=new MediaStream(blurBackgroundStream),rtc.changeStream(blurBackgroundStream,"video"),streamAudioAnalyser(document.getElementById("myVideoChatVideo"),blurBackgroundStream)},!1),(n=document.createElement("canvas")).id="myVideoChatVideoCanvas");n.getContext("2d",{alpha:!1});e.dataset.bluring="true"}else try{checkDeviceSupport(async(t,n,o,a)=>{backgroundMusicStream=videoChatBackgroundMusic.captureStream();let r=mediaStream.getVideoTracks(),i=mediaStream.getAudioTracks();Boolean(r.length),Boolean(i.length);rtc.changeStream(mediaStream,"video"),document.getElementById("myVideoChatVideo").srcObject=new MediaStream(mediaStream),streamAudioAnalyser(document.getElementById("myVideoChatVideo"),mediaStream),e.dataset.bluring="false"})}catch(e){console.error("Error: "+e)}}function askSatisfaction(){fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.3.6/dom/stars-rating.txt").then(e=>e.text()).then(e=>{swal({title:"How is the audio and video quality in this call?",showCancelButton:!1,showConfirmButton:!0,html:e,preConfirm:()=>new Promise((e,t)=>{let n=document.querySelector('input[name="rating"]:checked').value,o=document.querySelector("#video-chat-feedback").value,a=document.querySelector("#videoChatRoomId").innerHTML,r=document.querySelector("#videoChatRoomName").innerHTML;n||o?e({rating:n||0,feedback:o||"",roomId:a,roomName:r||""}):t()}),width:800,background:"rgba(30, 30, 30, .8)"}).then(e=>{e.value&&fetch("/meet/satisfaction",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify(e.value)})})})}function hideAllVideoChatUserNames(){document.querySelectorAll("#videoChatVideos .videoContainer span.name").forEach(e=>e.classList.add("hidden"))}function showAllVideoChatUserNames(){document.querySelectorAll("#videoChatVideos .videoContainer span.name").forEach(e=>e.classList.remove("hidden"))}const TQSOCKET=()=>{return new class{constructor(){this.socket=null,this.avatar="",this.room=null,this.name=""}join(e){this.socket=io.connect("/meet",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:1e3,reconnectionAttempts:1/0}),this.socket.on("connect",()=>{this.socket.emit("join",e)}),this.socket.on("roomUid",e=>{document.querySelector("#videoChatRoomId").innerHTML=e.uid,document.querySelector("#videoChatRoomId").closest(".SwitchCard").dataset.text=e.uid,document.querySelector("#videoChatRoomName").innerHTML=e.name,document.querySelector("#videoChatRoomName").closest(".SwitchCard").dataset.text=e.name}),this.socket.on("updateName",e=>{e.forEach(e=>{document.querySelector(`#other-${e.rtc}`)&&(document.querySelector(`#other-${e.rtc}`).closest(".videoContainer").querySelector("span.name").innerText=e.name)})}),this.socket.on("receive_message",e=>{let t=DOMPurify.sanitize(`${e.content}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br"],FORBID_ATTR:["style"]}),n=!1,o=document.querySelector("#videoChatForm .content-container .chat-thread").lastElementChild;o&&(n=o.dataset.user===e.id);let a=n?"":`\n                    <div class="avatar-container">\n                        <img class="avatar" src="${e.avatar}?height=100&width=100" loading="lazy" alt="Image not found" onerror="imageNotFound(this)">\n                        <span class="name">${e.name}</span>\n                    </div>\n                `;if(document.querySelector("#videoChatForm .content-container .chat-thread").insertAdjacentHTML("beforeend",`\n                    <li class="message-other" data-user="${e.id}">\n                        ${a}\n                        ${t}\n                    </li>\n                `),scrollToDown(document.querySelector("#videoChatMessenger .content-container .chat-thread")),"false"===document.querySelector('#videoChatForm button[name="comment"]').dataset.isopen){let e=document.querySelector('#videoChatForm button[name="comment"]').dataset.count||0;document.querySelector('#videoChatForm button[name="comment"]').dataset.count=Number(e)+1}notificationSound()}),this.socket.on("receive_media",e=>{const t=uuid();let n="";new Promise((o,a)=>{e.files.forEach((e,a,r)=>{e.type.match("image")?n+=`\n                                <li>\n                                    <a href="/images/MeetAlbum/${e.image}" data-fslightbox="${t}">\n                                        <img src="/images/MeetAlbum/${e.image}" alt="Image not found" onerror="imageNotFound(this)" />\n                                    </a>\n                                </li>\n                            `:n+=`\n                                <li>\n                                    <div class="video-tag"><span class="video-icon"></span></div>\n                                    <a href="/images/MeetAlbum/${e.video}" data-fslightbox="${t}">\n                                        <video src="/images/MeetAlbum/${e.video}" class="lozad" controlsList="nodownload" loop muted></video>\n                                    </a>\n                                </li>\n                            `,a===r.length-1&&o()})}).then(()=>{let t=!1,o=document.querySelector("#videoChatForm .content-container .chat-thread").lastElementChild;o&&(t=o.dataset.user===e.id);let a=t?"":`\n                        <div class="avatar-container">\n                            <img class="avatar" src="${e.avatar}?height=100&width=100" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" />\n                            <span class="name">${e.name}</span>\n                        </div>\n                    `;document.querySelector("#videoChatMessenger .content-container ul.chat-thread").insertAdjacentHTML("beforeend",`\n                        <li class="file-other" data-user="${e.id}">\n                            ${a}\n                            <ul class="media">${n}</ul>\n                        </li>\n                    `),scrollToDown(document.querySelector("#videoChatMessenger .content-container ul.chat-thread")),refreshFsLightbox(),notificationSound()}).catch(e=>{if(e)throw e})}),this.socket.on("receive_file",e=>{let t=uuid(),n="";for(let o=0;o<e.files.length;o++)n+=`\n                        <div class="upload" id="file-${t}">\n                            <div class="icon">\n                                <i class="fas fa-file"></i>\n                            </div>\n                            <div class="text">\n                                <div class="header">${e.files[o].file}</div>\n                                <span>${getReadableFileSizeString(e.files[o].size)}</span>\n                            </div>\n                        </div>\n                    `;let o=!1,a=document.querySelector("#videoChatForm .content-container .chat-thread").lastElementChild;a&&(o=a.dataset.user===e.id);let r=o?"":`\n                    <div class="avatar-container">\n                        <img class="avatar" src="${e.avatar}?height=100&width=100" loading="lazy" alt="Image not found" onerror="imageNotFound(this)">\n                        <span class="name">${e.name}</span>\n                    </div>\n                `;document.querySelector("#videoChatMessenger .content-container ul.chat-thread").insertAdjacentHTML("beforeend",`\n                    <li class="file-other" id="file-${t}" data-user="${e.id}">\n                        ${r}\n                        ${n}\n                    </li>\n                `),scrollToDown(document.querySelector("#videoChatMessenger .content-container ul.chat-thread")),notificationSound()})}sendMyName(e,t){this.socket.emit("sendName",e,t)}sendMessage(e){this.socket.emit("sendMessage",e)}sendMedia(e){this.socket.emit("sendMedia",e)}sendFile(e){this.socket.emit("sendFile",e)}lockRoom(e){this.socket.emit("lock-room",e)}close(){this.socket.close(),this.room=null}}};let meetSocket=TQSOCKET();function sendMeetMsg(){let e=event.which||event.keyCode;if(13===e&&event.shiftKey&&(event.preventDefault(),document.execCommand("insertHTML",!1,"<br></br>")),13==e&&!event.shiftKey){event.preventDefault();let e=document.getElementById("videoChatInput"),t=e.innerHTML,n=DOMPurify.sanitize(`${t}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br"],FORBID_ATTR:["style"]});if(t&&n){let o={avatar:$STATE.meet.avatar,name:$STATE.meet.name,content:t};meetSocket.sendMessage(o),e.innerHTML="",document.querySelector("#videoChatMessenger .content-container .chat-thread").insertAdjacentHTML("beforeend",`\n                <li class="message-personal">${n}</li>\n            `),document.querySelector("#videoChatMessenger .emoji-picker-menu").classList.remove("active"),scrollToDown(document.querySelector("#videoChatMessenger .content-container .chat-thread"))}}}function videoChatMsgEmojiListToggle(){document.querySelector('#videoChatMessenger [contenteditable="true"]').focus(),document.querySelector("#videoChatMessenger .emoji-picker-menu").classList.toggle("active"),fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.3.1/dom/emoji.txt").then(e=>e.text()).then(e=>document.querySelector("#videoChatMessenger .emoji-picker-menu").innerHTML=e)}function clickVideoChatMediaInput(){document.getElementById("videoChatMediaInput").click()}function videoChatMediaUpload(e,t){if(e.files.length){let n=[...e.files].map(e=>e.size),o=0;const a=(e=>t=>e+=t)(0);let r=n.map(a);const i=new FormData;[...e.files].forEach(e=>i.append("file",e)),axios({method:"post",url:"/upload/meet/media",data:i,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let e=document.querySelectorAll(`#file-${t} .circle`),n=function(e,t){let n=e.sort((e,t)=>e-t).findIndex(e=>t<=e);return-1===n?e.length:n}(r,event.loaded),a=Math.floor(event.loaded/r[n]*100);if(e[n]){let t=e[n].getTotalLength();!function(){let o=t/100*(a=100-a);e[n].style["stroke-dashoffset"]=o}()}o!==n&&(e[o].style["stroke-dashoffset"]=0,o=n)}}}).then(e=>{if(e.data.files){let t={avatar:$STATE.meet.avatar,name:$STATE.meet.name,files:e.files};meetSocket.sendMedia(t)}document.querySelectorAll(`#file-${t} .uploading`).forEach(e=>e.classList.remove("uploading")),document.querySelectorAll(`#file-${t} svg`).forEach(e=>e.remove()),scrollToDown(document.querySelector("#videoChatMessenger .content-container ul.chat-thread"))})}}async function videoChatMediaInputChange(){if(event.currentTarget.files.length){const e=uuid();let t="";new Promise((n,o)=>{[...event.currentTarget.files].forEach((o,a,r)=>{let i=URL.createObjectURL(o);o.type.match("image")?t+=`\n                        <li>\n                            <a href="${i}" data-fslightbox="${e}">\n                                <img src="${i}" class="uploading" alt="Image not found" onerror="imageNotFound(this)" />\n                                <svg version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                                    <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                    <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                </svg>\n                            </a>\n                        </li>\n                    `:t+=`\n                        <li>\n                            <div class="video-tag"><span class="video-icon"></span></div>\n                            <a href="${i}" data-fslightbox="${e}">\n                                <video src="${i}" class="lozad uploading" controlsList="nodownload" loop muted></video>\n                                <svg version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                                    <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                    <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                </svg>\n                            </a>\n                        </li>\n                    `,a===r.length-1&&n()})}).then(()=>{document.querySelector("#videoChatMessenger .content-container ul.chat-thread").insertAdjacentHTML("beforeend",`\n                <li class="file-personal" id="file-${e}">\n                    <ul class="media">${t}</ul>\n                </li>\n            `),scrollToDown(document.querySelector("#videoChatMessenger .content-container")),refreshFsLightbox(),setfsLightboxProps(),videoChatMediaUpload(event.currentTarget,e)}).catch(e=>{if(e)throw e})}}function clickVideoChatFileInput(){document.getElementById("videoChatFileInput").click()}function videoChatFileUpload(e,t){if(e.files.length){let n=[...e.files].map(e=>e.size);const o=(e=>t=>e+=t)(0);let a=n.map(o);const r=new FormData;[...e.files].forEach(e=>r.append("file",e)),axios({method:"post",url:"/upload/meet/file",data:r,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let n=document.querySelectorAll(`#file-${t} .upload`),o=function(e,t){let n=e.sort((e,t)=>e-t).findIndex(e=>t<=e);return-1===n?e.length:n}(a,e.loaded),r=Math.floor(e.loaded/a[o]*100);n[o]&&n[o].style.setProperty("--percent",Math.floor(r))}}}).then(e=>{if(e.data.files){let t={avatar:$STATE.meet.avatar,name:$STATE.meet.name,files:e.files};meetSocket.sendFile(t)}document.querySelectorAll(`#file-${t} .upload`).forEach(e=>{e.classList.remove("uploading"),e.querySelector(".percent").remove()}),scrollToDown(document.querySelector("#videoChatMessenger .content-container ul.chat-thread"))})}}async function videoChatFileInputChange(){if(event.currentTarget.files.length){const e=uuid();let t="";for(let e=0;e<event.currentTarget.files.length;e++){let n=event.currentTarget.files[e];const o=uuid();event.currentTarget.files[e].preFileUid=o,t+=`\n                <div class="upload uploading" id="file-${o}">\n                    <div class="icon">\n                        <i class="fas fa-file"></i>\n                    </div>\n                    <div class="text">\n                        <div class="header">${n.name}</div>\n                        <span>${getReadableFileSizeString(n.size)}</span>\n                    </div>\n                    <div class="percent">\n                        <div>\n                            <svg preserveAspectRatio="none" viewBox="0 0 600 12">\n                                <path d="M0,1 L200,1 C300,1 300,11 400,11 L600,11" stroke="currentColor" fill="none"></path>\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n            `}document.querySelector("#videoChatMessenger .content-container ul.chat-thread").insertAdjacentHTML("beforeend",`\n            <li class="file-personal" id="file-${e}">${t}</li>\n        `),scrollToDown(document.querySelector("#videoChatMessenger .content-container ul.chat-thread")),videoChatFileUpload(event.currentTarget,e)}}function fetchMessager(e){fetch("/messenger/get_1",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({messenger:e.messenger})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("msg-friend-list").querySelectorAll("li").length>9&&document.getElementById("msg-friend-list").querySelectorAll("li")[9].remove(),document.getElementById("msg-friend-list").querySelectorAll("li")[0].insertAdjacentHTML("afterend",e.messenger_avatar_template),document.getElementById("messenger").insertAdjacentHTML("beforeend",e.messenger_content_template),tabReflash())})}function openNotification(){delete document.querySelector("#msg-friend-list .menuIcon").dataset.count,socket.emit("openNotification"),PageTitleNotification.off()}function msgEmojiListToggle(){let e=event.currentTarget.closest(".content-wrapper");e.querySelector('[contenteditable="true"]').focus(),e.querySelector(".content-container").classList.toggle("hidden"),e.querySelector(".emoji-picker-menu").classList.toggle("active"),fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.3.1/dom/emoji.txt").then(e=>e.text()).then(t=>e.querySelector(".emoji-picker-menu").innerHTML=t)}function sendMsg(){let e=event.which||event.keyCode;if(13===e&&event.shiftKey&&(event.preventDefault(),document.execCommand("insertHTML",!1,"<br> </br>")),13==e&&!event.shiftKey){event.preventDefault();let e=DOMPurify.sanitize(event.currentTarget.innerHTML,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["style"]});if(e.length){let t=event.currentTarget.dataset.messenger;socket.emit("MessageText",{messenger:t,avatar:`/images/UserAlbum/${$STATE.userDefaultAlbums.avatar}/${$STATE.user.avatar}`,content:e});let n=!1,o=event.currentTarget.closest(".content-wrapper").querySelector("ul.chat-thread").lastElementChild;o&&(n=o.dataset.user===$STATE.user.uid),event.currentTarget.closest(".content-wrapper").querySelector("ul.chat-thread").insertAdjacentHTML("beforeend",`\n                <li class="message-personal" data-user="${$STATE.user.uid}">${e}</li>\n            `),scrollToDown(event.currentTarget.closest(".content-wrapper").querySelector(".content-container")),event.currentTarget.closest(".content-wrapper").querySelector(".content-container").classList.remove("hidden"),event.currentTarget.closest(".content-wrapper").querySelector(".emoji-picker-menu").classList.remove("active"),event.currentTarget.innerHTML="",socket.emit("messengerTypingStatus",{messenger:t,status:!1})}}}function openMessenger(){let e=event.currentTarget.dataset.messenger;if(e){socket.emit("openMessenger",e),scrollToDown(document.querySelector(`#msg-${e} .content-container`));let t=event.currentTarget.querySelector(".msg-avatar");t&&t.classList.remove("alert"),setTimeout(()=>{document.querySelector(`#msg-${e} [contenteditable=true]`).focus()},50)}document.querySelector("#messenger-wrapper").classList.add("active"),document.querySelector("#messenger-cover").classList.add("active")}function closeMessenger(){document.querySelector("#messenger-wrapper").classList.contains("active")&&(document.querySelector("#messenger-wrapper").classList.remove("active"),document.querySelector("#messenger-cover").classList.remove("active"))}function clickMsgFileInput(){let e=event.currentTarget.dataset.uid;document.getElementById(`msgFileInput-${e}`).click()}function getReadableFileSizeString(e){let t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]}async function msgFileInputChange(){let e=event.currentTarget.dataset.messenger;if(e&&[...event.currentTarget.files].length){const t=uuid();let n="";for(let e=0;e<[...event.currentTarget.files].length;e++){let t=event.currentTarget.files[e];const o=uuid();event.currentTarget.files[e].preFileUid=o,n+=`\n                <div class="upload uploading" id="file-${o}">\n                    <div class="icon">\n                        <i class="fas fa-file"></i>\n                    </div>\n                    <div class="text">\n                        <div class="header">${t.name}</div>\n                        <span>${getReadableFileSizeString(t.size)}</span>\n                    </div>\n                    <ul>\n                        <li><i class="fas fa-times"></i></li>\n                    </ul>\n                    <div class="percent">\n                        <div>\n                            <svg preserveAspectRatio="none" viewBox="0 0 600 12">\n                                <path d="M0,1 L200,1 C300,1 300,11 400,11 L600,11" stroke="currentColor" fill="none"></path>\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n            `}document.querySelector(`#msg-${e} .content-container ul.chat-thread`).insertAdjacentHTML("beforeend",`\n            <li class="file-personal" id="file-${t}">${n}</li>\n        `),scrollToDown(document.querySelector(`#msg-${e} .content-container`));let o=[...event.currentTarget.files].map(e=>e.size).map((e=>t=>e+=t)(0));let a=new FormData;[...event.currentTarget.files].forEach(e=>a.append("file",e)),axios({method:"post",url:`/upload/messenger/file?messenger=${e}`,data:a,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let n=document.querySelectorAll(`#file-${t} .upload`),a=function(e,t){let n=e.sort((e,t)=>e-t).findIndex(e=>t<=e);return-1===n?e.length:n}(o,e.loaded),r=Math.floor(e.loaded/o[a]*100);n[a]&&n[a].style.setProperty("--percent",Math.floor(r))}}}).then(e=>{document.querySelectorAll(`#file-${t} .upload`).forEach(e=>{e.classList.remove("uploading"),e.querySelector(".percent").remove(),e.querySelector("ul").remove()})})}}function clickMsgMediaInput(){let e=event.currentTarget.dataset.uid;document.getElementById(`msgMediaInput-${e}`).click()}async function msgMediaInputChange(e){let t=e.dataset.messenger;if(t&&[...e.files].length){const n=uuid();let o="";new Promise((t,a)=>{[...e.files].forEach((e,a,r)=>{let i=URL.createObjectURL(e);e.type.match("image")?(o+=`\n                        <li>\n                            <a href="${i}" data-fslightbox="${n}">\n                                <img src="${i}" class="uploading" alt="Image not found" onerror="imageNotFound(this)" />\n                                <svg version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                                    <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                    <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                </svg>\n                            </a>\n                        </li>\n                    `,a===r.length-1&&t()):(o+=`\n                        <li>\n                            <div class="video-tag"><span class="video-icon"></span></div>\n                            <a href="${i}" data-fslightbox="${n}">\n                                <video src="${i}" class="lozad uploading" controlsList="nodownload" loop muted></video>\n                                <svg version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                                    <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                    <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                                </svg>\n                            </a>\n                        </li>\n                    `,a===r.length-1&&t())})}).then(()=>{document.querySelector(`#msg-${t} .content-container ul.chat-thread`).insertAdjacentHTML("beforeend",`\n                <li class="file-personal" id="file-${n}">\n                    <ul class="media">${o}</ul>\n                </li>\n            `),scrollToDown(document.querySelector(`#msg-${t} .content-container`));let e=[...event.currentTarget.files].map(e=>e.size),a=0,r=e.map((e=>t=>e+=t)(0));let i=new FormData;[...event.currentTarget.files].forEach(e=>i.append("file",e)),axios({method:"post",url:`/upload/messenger/media?messenger=${t}`,data:i,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let t=document.querySelectorAll(`#file-${n} .circle`),o=function(e,t){let n=e.sort((e,t)=>e-t).findIndex(e=>t<=e);return-1===n?e.length:n}(r,e.loaded),i=Math.floor(e.loaded/r[o]*100);if(t[o]){let e=t[o].getTotalLength();!function(){let n=e/100*(i=100-i);t[o].style["stroke-dashoffset"]=n}()}a!==o&&(t[a].style["stroke-dashoffset"]=0,a=o)}}}).then(e=>{document.querySelectorAll(`#file-${n} .uploading`).forEach(e=>e.classList.remove("uploading")),document.querySelectorAll(`#file-${n} svg`).forEach(e=>e.remove()),refreshFsLightbox(),setfsLightboxProps()})}).catch(e=>{if(e)throw e})}}function msgIsTexting(){let e=event.currentTarget.dataset.messenger,t=!!event.currentTarget.innerHTML.trim().length;e&&socket.emit("messengerTypingStatus",{messenger:e,status:t})}function appendToMsgFriendList(){let e=event.currentTarget.dataset.messenger;event.currentTarget.querySelector("img").src;if(document.querySelector(`#msg-friend-list li[data-messenger="${e}"]`)){let t=document.querySelector(`#msg-friend-list li[data-messenger="${e}"]`),n=document.getElementById("msg-friend-list");n.insertBefore(t,n.childNodes[1])}else fetch("/messenger/get_1",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({messenger:e})}).then(e=>e.json()).then(e=>{document.getElementById("msg-friend-list").querySelectorAll("li").length>8&&document.getElementById("msg-friend-list").querySelectorAll("li")[8].remove(),document.getElementById("msg-friend-list").querySelectorAll("li")[0].insertAdjacentHTML("afterend",e.messenger_avatar_template),document.getElementById("messenger").insertAdjacentHTML("beforeend",e.messenger_content_template),tabReflash()})}function downloadMsgFile(){let{msg:e,uid:t}=event.currentTarget.dataset;fetch("/downloadMsgFile",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},body:JSON.stringify({msg:e,uid:t}),credentials:"include"}).then(e=>e.blob()).then(e=>{download(e,`tranquility_${moment().format("lll")}_download.zip`)})}function leaveMsgGroup(){let e=event.currentTarget.dataset.msg;Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",background:"rgba(47, 47, 47, .8)"}).then(t=>{t.value&&(document.querySelector(`#msg-${e}`).remove(),document.querySelector(`#msg-friend-list li[data-messenger="${e}"]`).remove(),tabReflash(),fetch("/leaveMsgGroup",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({msg:e})}))})}function addFriendToMsgGroup(){let e=event.currentTarget.dataset.msg;e&&(Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("/friendList",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(t=>{if(Swal.close(),200===t.status){let n="";for(let e=0;e<t.friends.length;e++)n+=`<li>\n                        <input type="checkbox" name="friend" value="${t.friends[e].user}" id="friend-${t.friends[e].user}" />\n                        <label for="friend-${t.friends[e].user}">\n                            <img src="/img/UserAlbum/${t.friends[e].avatar.album}/${t.friends[e].avatar.image}?height=100&width=100" class="lozad" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" />\n                        </label>\n                    </li>`;Swal.fire({title:"<strong>Select friends</strong>",html:`<ul class="image-radio">${n}</ul>`,focusConfirm:!1,width:800,confirmButtonText:"Select",background:"rgba(47, 47, 47, .8)",preConfirm:function(){return new Promise((e,t)=>{e([...document.querySelectorAll('input[name="friend"]:checked')].map(e=>e.value))})}}).then(t=>{t.value&&fetch("/addFriendToMsgGroup",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({msg:e,users:t.value})}).then(e=>e.json()).then(t=>{if(200===t.status){let n="";for(let o=0;o<t.invitingUsersInfos.length;o++)n+=`<div class="3u 6u(large) 12u(small)">\n                                        <figure class="ContactCard" data-name="${t.invitingUsersInfos[o].name||t.invitingUsersInfos[o].nickname}" data-zoom>\n                                            <img src="/images/UserAlbum/${t.invitingUsersInfos[o].cover.album}/${t.invitingUsersInfos[o].cover.image}" class="banner lozad" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" />\n                                            <img src="/images/UserAlbum/${t.invitingUsersInfos[o].avatar.album}/${t.invitingUsersInfos[o].avatar.image}" class="avatar lozad" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" />\n                                            <div class="title">${t.invitingUsersInfos[o].name||t.invitingUsersInfos[o].nickname}</div>\n                                            <ul>\n                                                <li data-user="${t.invitingUsersInfos[o].user}" onclick="getUserPage(this)"><i class="far fa-user"></i></li>\n                                                <li class="gray" data-msg="${e}" data-user="${t.invitingUsersInfos[o].user}" onclick="rmMemberInMsgGroup()"><i class="fas fa-user-times"></i></li>\n                                            </ul>\n                                        </figure>\n                                    </div>`;document.querySelector("#messenger-members .row").insertAdjacentHTML("beforeend",`${n}`)}else toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})})}}))}function rmMemberInMsgGroup(){let{msg:e,user:t}=event.currentTarget.dataset,n=event.currentTarget.closest(".ContactCard");e&&t&&Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",background:"rgba(47, 47, 47, .8)"}).then(o=>{o.value&&(loadingBtn(),fetch("/rmMemberInMsgGroup",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({msg:e,user:t})}).then(e=>e.json()).then(o=>{200===o.status?(n.remove(),t===$STATE.user.uid&&(document.querySelector("#explorer").classList.remove("active"),document.querySelector(`#msg-${e}`).remove(),document.querySelector(`#msg-friend-list li[data-messenger="${e}"]`).remove())):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))})}function createMsgGroup(){disabledTwoSeconds(),$STATE.isGuest?toast({type:"error",title:`${i18next.t("Please login to continue")}`}):(showPageLoadingAnimation(),fetch("/friendList",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{if(hidePageLoadingAnimation(),200===e.status){let t="";for(let n=0;n<e.friends.length;n++)t+=`<li>\n                        <input type="checkbox" name="friend" value="${e.friends[n].user}" id="friend-${e.friends[n].user}" />\n                        <label for="friend-${e.friends[n].user}">\n                            <img src="/img/UserAlbum/${e.friends[n].avatar.album}/${e.friends[n].avatar.image}?height=100&width=100" class="lozad" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" />\n                        </label>\n                    </li>`;Swal.fire({title:"Create new conversation",text:"select friends",html:`<ul class="image-radio">${t}</ul>`,focusConfirm:!1,width:800,confirmButtonText:"Create",background:"rgba(47, 47, 47, .8)",preConfirm:function(){return new Promise((e,t)=>{e([...document.querySelectorAll('input[name="friend"]:checked')].map(e=>e.value))})}}).then(e=>{e.value&&fetch("/createMsgGroup",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({friends:e.value})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("msg-friend-list").querySelectorAll("li")[0].insertAdjacentHTML("afterend",e.messenger_avatar_template),document.querySelector("#messenger").insertAdjacentHTML("beforeend",e.messenger_content_template),document.getElementById("msg-friend-list").querySelectorAll("li").length>9&&document.getElementById("msg-friend-list").querySelectorAll("li")[9].remove(),tabReflash())})})}}))}function renameMsg(){let e=event.currentTarget.dataset.msg;e&&swal({title:`${i18next.t("Rename")}`,text:`${i18next.t("Give your album a special name")}`,input:"text",showCancelButton:!0,confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`,showLoaderOnConfirm:!0,background:"rgba(47, 47, 47, .8)"}).then(t=>{t.value&&(document.querySelector(`#msg-${e} .name`).innerText=t.value,fetch("/renameMsg",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({msg:e,name:t.value})}))})}function msgSetting(){let e=event.currentTarget.dataset.msg;closeMessenger(),e&&(showAppLoading(),fetch("/messengerMemberInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({msg:e})}).then(e=>e.json()).then(e=>{200===e.status?(document.querySelector("#app").innerHTML=e.template,tabReflash(),zoomAnimation()):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}function fetchMessage(){let e=event.currentTarget.dataset.messenger;"false"===event.currentTarget.dataset.isfetched&&(fetch("/messenger/getMessage",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({messenger:e})}).then(e=>e.json()).then(t=>{200===t.status&&(document.querySelector(`#msg-${e} .chat-thread`).insertAdjacentHTML("afterbegin",`${t.template}`),scrollToDown(document.querySelector(`#msg-${e} .content-container`)),document.querySelector(`#msg-${e}`).dataset.isloading="false",refreshFsLightbox(),setfsLightboxProps())}),event.currentTarget.dataset.isfetched="true")}function notSupport(){toast({type:"info",title:`${i18next.t("It is not supported yet")}`})}function setfsLightboxProps(){let e=1e3*$STATE.user.property.sliderDisplayDuration,t=$STATE.user.property.showSliderThumbnails;Object.keys(fsLightboxInstances).forEach(n=>{fsLightboxInstances[n].props.slideshowTime=e,fsLightboxInstances[n].props.showThumbsOnMount=t})}function closePopupCover(){event.target.classList.contains("popupCover")&&event.target.classList.remove("active")}function rmPopupCover(){event.target.classList.contains("popupCover")&&event.target.remove()}function sliderToggle(){let e=event.currentTarget.closest(".slider-wrapper").querySelector(".slider-menu"),t=(event.currentTarget.closest(".slider-wrapper").querySelector(".slider-btn i"),event.currentTarget.closest(".slider-wrapper").querySelector(".slider-content"));t.classList.contains("isOpen")?(e.classList.add("hidden"),t.classList.remove("isOpen")):(e.classList.remove("hidden"),t.classList.add("isOpen")),event.currentTarget.closest(".slider-wrapper").querySelector(".burger-btn").classList.toggle("open")}function uuid(){let e=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}function getRndInteger(e,t){return Math.floor(Math.random()*(t-e))+e}function getRndString(e){let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length;for(let a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*o));return t}function pasteHtmlAtCaret(e){let t,n;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(n=t.getRangeAt(0)).deleteContents();let o=document.createElement("div");o.innerHTML=e;let a,r,i=document.createDocumentFragment();for(;a=o.firstChild;)r=i.appendChild(a);n.insertNode(i),r&&((n=n.cloneRange()).setStartAfter(r),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(e)}function addIcon(){let e=event.currentTarget.querySelector("img").src;e&&pasteHtmlAtCaret(`&nbsp;<img class="emoji" src="${e}" unselectable="on" alt="Image not found" onerror="imageNotFound(this)" />&nbsp;`)}function emojiPickerMenuToggle(){let e=event.currentTarget.closest(".message-input-wrapper");e.querySelector('[contenteditable="true"]').focus(),e.querySelector(".emoji-picker-menu").classList.toggle("hidden"),fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.3.1/dom/emoji.txt").then(e=>e.text()).then(t=>e.querySelector(".emoji-picker-menu").innerHTML=t)}function commentFileIuputToggle(e){e.closest(".message-input-wrapper").querySelector('input[type="file"]').click()}function disabledTwoSeconds(){"BOTTOM"===event.currentTarget.nodeName&&(event.currentTarget.disabled=!0,setTimeout(()=>{event.currentTarget.disabled=!1},2e3))}function loadingBtn(){event.preventDefault(),event.currentTarget.innerHTML='<i class="fa fa-spinner fa-spin"></i>',event.currentTarget.style.pointerEvents="none","BOTTOM"===event.currentTarget.nodeName&&(event.currentTarget.disable=!0)}function contenteditableRichText(){if(13!==(event.which||event.keyCode)){let e=getCaretCharacterOffsetWithin(event.currentTarget);event.currentTarget.innerHTML=event.currentTarget.innerHTML.replace(/(<span class="hashtag">)/gi,""),event.currentTarget.innerHTML=event.currentTarget.innerHTML.replace(/(<span class="attag">)/gi,""),event.currentTarget.innerHTML=event.currentTarget.innerHTML.replace(/(<a>)/gi,""),event.currentTarget.innerHTML=event.currentTarget.innerHTML.replace(/(^|\s|&nbsp;)(#[a-z\d-]+)/gi,"$1<span class='hashtag'>$2</span>"),event.currentTarget.innerHTML=event.currentTarget.innerHTML.replace(/(^|\s|&nbsp;)(http(s?):\/\/([^\s]+))/gi,"$1<a href='$2' target='_blank'>$2</a>"),event.currentTarget.innerHTML=DOMPurify.sanitize(event.currentTarget.innerHTML,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["style"]}),SetAtCaretPosition(event.currentTarget,e)}}function SetCaretPosition(e,t){let n=e.childNodes;for(let e=0,o=n.length;e<o;e++){let o=n[e];if(3==o.nodeType){if(o.length>=t){let e=document.createRange(),n=window.getSelection();return e.setStart(o,t),e.collapse(!0),n.removeAllRanges(),n.addRange(e),-1}t-=o.length}else if(-1==(t=SetCaretPosition(o,t)))return-1}return t}function getCaretCharacterOffsetWithin(e){let t=0;if(void 0!==window.getSelection){let n=window.getSelection().getRangeAt(0),o=n.cloneRange();o.selectNodeContents(e),o.setEnd(n.endContainer,n.endOffset),t=o.toString().length}else if(void 0!==document.selection&&"Control"!=document.selection.type){let n=document.selection.createRange(),o=document.body.createTextRange();o.moveToElementText(e),o.setEndPoint("EndToEnd",n),t=o.text.length}return t}function SetAtCaretPosition(e,t){let n=e.childNodes;for(let e=0,o=n.length;e<o;e++){let o=n[e];if(3==o.nodeType){if(o.length>=t){let e=document.createRange(),n=window.getSelection();return e.setStart(o,t),e.collapse(!0),n.removeAllRanges(),n.addRange(e),-1}t-=o.length}else if(-1==(t=SetAtCaretPosition(o,t)))return-1}return t}function tableReflash(){document.querySelectorAll("table[data-table]").forEach(e=>new DataTable(e,{perPage:50,perPageSelect:[50,100,500,1e3]}))}function tabReflash(){document.querySelectorAll("ul[data-tabs]").forEach(e=>{let t=new Array,n=new Array,o=e.childNodes;for(let e=0;e<o.length;e++)if("LI"==o[e].nodeName){let a=o[e].dataset.href;document.getElementById(a)&&(t[a]=o[e],n[a]=o[e].dataset.href)}for(let e in t)t[e].addEventListener("click",e=>{a(e.currentTarget)});for(let e in n)document.getElementById(e).setAttribute("style","transition: all 1s;"),0;function a(e){let o=e.dataset.href;for(let e in n)e===o?(t[e].classList.add("selected"),document.getElementById(e).classList.remove("hidden")):(t[e].classList.remove("selected"),document.getElementById(e).classList.add("hidden"));return window.scrollTo(0,0),AOS.refresh(),!1}})}function optionBtnsToggle(){let e=event.currentTarget.closest(".option-btns");e.querySelector("i").classList.toggle("fa-search"),e.querySelector("i").classList.toggle("fa-bars"),"true"===e.dataset.toggle?(e.dataset.toggle="false",e.querySelector(".options").style.transform="rotate(90deg)",e.querySelector(".search input").style.transform="rotate(0deg)",e.querySelector(".search input").select()):(e.dataset.toggle="true",e.querySelector(".options").style.transform="rotate(0deg)",e.querySelector(".search input").style.transform="rotate(90deg)",e.querySelector(".search input").blur())}function showPageLoadingAnimation(){document.getElementById("loading-wrapper").style.display="flex"}function hidePageLoadingAnimation(){document.getElementById("loading-wrapper").style.display="none"}function editAvatarInputTrigger(){event.currentTarget.querySelector("input").click()}function editAvatarActiveOptions(){event.currentTarget.closest(".edit-avatar").querySelector(".options").classList.toggle("hidden")}function editAvatarInputTriggerByOptions(){event.currentTarget.closest(".edit-avatar").querySelector("input").click()}function channelUploadSource(){let e=event.currentTarget,{channel:t,action:n}=event.currentTarget.dataset;if(t&&n&&event.currentTarget.files.length){const o=event.currentTarget.files[0],a=new FormData;a.append("file",o),event.currentTarget.closest(".edit-avatar").querySelector("svg").classList.add("active"),fetch(`/upload/channel/source?channel=${t}&action=${n}`,{method:"POST",headers:{Accept:"application/json, text/plain, */*","CSRF-Token":$STATE.csrfToken},body:a,withCredentials:!0}).then(e=>e.json()).then(o=>{if(200===o.status){const o=URL.createObjectURL(e.files[0]);switch(e.closest(".edit-avatar").querySelector("svg").classList.remove("active"),e.closest(".edit-avatar").querySelector("img").src=o,e.closest(".edit-avatar").querySelectorAll("picture source").forEach(e=>e.srcset=o),n){case"avatar":document.querySelector("#lobby .side-menu").querySelectorAll(`li[data-channel="${t}"] img`).forEach(e=>e.src=o),document.querySelector("#lobby .side-menu").querySelectorAll(`li[data-channel="${t}"] picture source`).forEach(e=>e.srcset=o)}}})}}function rotateImg(){let e=event.currentTarget,t=Number(event.currentTarget.dataset.deg||90),{category:n,album:o,uid:a,image:r}=event.currentTarget.dataset;n&&o&&a&&r&&(event.currentTarget.closest(".album-container").querySelector("img").style.transform=`rotate(${t}deg)`,event.currentTarget.dataset.deg=t+90,event.currentTarget.closest(".more-items").querySelectorAll("li").forEach(e=>e.style.pointerEvents="none"),loadingBtn(),fetch("/rotateImg",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({category:n,album:o,uid:a,image:r})}).then(e=>e.json()).then(t=>{200===t.status?(e.dataset.image=t.image,e.style.pointerEvents="auto",e.closest(".more-items").querySelectorAll("li").forEach(e=>e.style.pointerEvents="auto"),e.closest(".more-items").querySelectorAll("li").forEach(e=>e.dataset.image=t.image),e.innerHTML=`<i class="fas fa-redo"></i> ${i18next.t("Rotate")}`):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}function mvSource(){let e=event.currentTarget.closest(".album-container"),{source:t,album:n,category:o,group:a,page:r}=event.currentTarget.dataset,i={};if(t&&n&&o)switch(showPageLoadingAnimation(),o){case"user":fetch("/album/list",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({category:o})}).then(e=>e.json()).then(a=>{if(hidePageLoadingAnimation(),200===a.status){for(let e=0;e<a.albums.length;e++)i[a.albums[e].uid]=a.albums[e].title;Swal.fire({title:`${i18next.t("Create a text avatar")}`,input:"select",inputOptions:i,showLoaderOnConfirm:!0,background:"rgba(30, 30, 30, .8)"}).then(a=>{a.value&&(Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("/mvSource",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({category:o,album:n,newAlbum:a.value,source:t})}).then(e=>e.json()).then(t=>{Swal.close(),200===t.status?e.remove():toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))})}else toast({type:"error",title:`${i18next.t("Something went wrong!")}`})});break;case"group":if(!a)return;fetch("/album/list",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:a,category:o})}).then(e=>e.json()).then(a=>{if(hidePageLoadingAnimation(),200===a.status){for(let e=0;e<a.albums.length;e++)i[a.albums[e].uid]=a.albums[e].title;Swal.fire({title:`${i18next.t("Create a text avatar")}`,input:"select",inputOptions:i,showLoaderOnConfirm:!0,background:"rgba(30, 30, 30, .8)"}).then(a=>{a.value&&(Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("/mvSource",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({category:o,album:n,newAlbum:a.value,source:t})}).then(e=>e.json()).then(t=>{Swal.close(),200===t.status?e.remove():toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))})}else toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})}}function setAsAvatar(){let e=event.currentTarget,{category:t,album:n,uid:o,image:a}=event.currentTarget.dataset;if(t&&n&&o&&a){loadingBtn(),event.currentTarget.closest(".more-items").querySelectorAll("li").forEach(e=>e.style.pointerEvents="none"),fetch("/setAsAvatar",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({category:t,album:n,uid:o,image:a})}),e.style.pointerEvents="auto",e.closest(".more-items").querySelectorAll("li").forEach(e=>e.style.pointerEvents="auto"),e.innerHTML=`<i class="fas fa-user-circle"></i> ${i18next.t("Set as avatar")}`;let r=e.closest(".album-container").querySelector("img").src;document.querySelector('#nav-bar li[data-url="me"] img').src=r,document.querySelector("#nav-bar").querySelectorAll('li[data-url="me"] picture source').forEach(e=>e.srcset=r)}}function userUploadSource(e){let{album:t,action:n}=e.dataset;if(t&&n&&e.files.length){const o=e.files[0],a=new FormData;let r;switch(a.append("file",o),e.closest(".edit-avatar").querySelector("svg").classList.add("active"),n){case"avatar":r=`/upload/user/avatar?album=${t}`;break;case"cover":r=`/upload/user/cover?album=${t}`;break;case"background":r=`/upload/user/background?album=${t}`}fetch(r,{method:"POST",headers:{Accept:"application/json, text/plain, */*","CSRF-Token":$STATE.csrfToken},body:a,withCredentials:!0}).then(e=>e.json()).then(t=>{if(200===t.status){const t=URL.createObjectURL(e.files[0]);switch(e.closest(".edit-avatar").querySelector("svg").classList.remove("active"),e.closest(".edit-avatar").querySelector("img").src=t,e.closest(".edit-avatar").querySelectorAll("picture source").forEach(e=>e.srcset=t),n){case"avatar":document.querySelector('#nav-bar li[data-url="me"] img').src=t,document.querySelector("#nav-bar").querySelectorAll('li[data-url="me"] picture source').forEach(e=>e.srcset=t);break;case"cover":break;case"background":document.body.style.cssText=`background: linear-gradient(to right, rgba(24, 24, 24, 0.9) 0%, rgba(34, 34, 34, 0.7) 25%, rgba(34, 34, 34, 0.9) 50%, rgba(34, 34, 34, 0.7) 75% ,rgba(24, 24, 24, 0.9) 100%), url('${t}') no-repeat center center fixed; background-size: cover;`}}})}}function setTextImage(e){let{album:t,category:n}=e.dataset;t&&n&&swal({title:`${i18next.t("Create a text avatar")}`,input:"text",showCancelButton:!0,confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`,showLoaderOnConfirm:!0,background:"rgba(30, 30, 30, .8)"}).then(o=>{if(o.value)switch(e.closest(".edit-avatar").querySelector("svg").classList.add("active"),n){case"user":fetch("/setTextImage",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({album:t,category:n,name:o.value})}).then(e=>e.json()).then(t=>{200===t.status&&(e.closest(".edit-avatar").querySelector("svg").classList.remove("active"),e.closest(".edit-avatar").querySelector("img").src=t.image,e.closest(".edit-avatar").querySelectorAll("picture source").forEach(e=>e.srcset=t.image),document.querySelector('#nav-bar li[data-url="me"] img').src=t.image,document.querySelector("#nav-bar").querySelectorAll('li[data-url="me"] picture source').forEach(e=>e.srcset=t.image))});break;case"group":let a=e.dataset.group;a&&fetch("/setTextImage",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:a,album:t,category:n,name:o.value})}).then(e=>e.json()).then(t=>{200===t.status&&(e.closest(".edit-avatar").querySelector("svg").classList.remove("active"),e.closest(".edit-avatar").querySelector("img").src=t.image,e.closest(".edit-avatar").querySelectorAll("picture source").forEach(e=>e.srcset=t.image),document.querySelector(".ProfileCard img").src=t.image,document.querySelector(".ProfileCard").querySelectorAll("picture source").forEach(e=>e.srcset=t.image))})}})}function showChangePasswordForm(){Swal.mixin({input:"password",confirmButtonText:"Next &rarr;",showCancelButton:!0,background:"rgba(47, 47, 47, .75)",progressSteps:["1","2"],width:"800px"}).queue([{title:"New password",text:"Please enter a strong password of at least 6 characters. Do not use your passwords on other websites, or any passwords that are easy to crack (such as pet names)"},{title:"Repeat new password"}]).then(e=>{e.value&&(e.value[0]!==e.value[1]?Swal.fire({type:"error",title:`${i18next.t("Password not match")}`,background:"rgba(47, 47, 47, .75)"}):e.value[0].length<6?Swal.fire({type:"error",title:`${i18next.t("Password must be at least 6 characters")}`,background:"rgba(47, 47, 47, .75)"}):fetch("/account/changePasswd",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({newPasswd:e.value[0],reNewPasswd:e.value[1]})}).then(e=>e.json()).then(e=>{200===e.status?Swal.fire({type:"success",title:"Change!",confirmButtonText:"Lovely!",background:"rgba(47, 47, 47, .75)"}):Swal.fire({type:"error",title:"Something went wrong change password",confirmButtonText:"Oops",background:"rgba(47, 47, 47, .75)"})}))})}function changeNotificationSound(){let e=event.currentTarget.value;if(["cloud","glisten","polite","sharp","taptap"].includes(e)){let t=new Audio(`/T-Source/audio/${e}.wav`);t.volume=.5,t.play(),$STATE.user.property.notificationSound=e,$STATE.isGuest||fetch("/changeNotificationSound",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({notificationSound:e})})}}function videoChatDisableNotificationSoundAlert(){let e=event.currentTarget.classList.contains("on")?0:1;e?event.currentTarget.classList.add("on"):event.currentTarget.classList.remove("on"),$STATE.user.property.notificationSoundAlert=e}function videoChatFilterSensitiveContent(){let e=event.currentTarget.classList.contains("on")?0:1;e?event.currentTarget.classList.add("on"):event.currentTarget.classList.remove("on"),$STATE.user.property.filterSensitiveContent=e}function createGroup(){swal({title:`${i18next.t("Group name")}`,input:"text",confirmButtonText:`${i18next.t("Create")}`,background:"rgba(30, 30, 30, .8)"}).then(e=>{e.value&&(showPageLoadingAnimation(),fetch("/createGroup",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({name:e.value})}).then(e=>e.json()).then(e=>{hidePageLoadingAnimation(),200===e.status?getGroup(e.uid):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))})}function filterMyGroupByInput(){if(13===(event.which||event.keyCode)){event.preventDefault();let e=event.currentTarget.closest(".search").querySelector("input").value.toLowerCase();document.querySelectorAll("#myGroup .GroupCard").forEach(t=>{t.dataset.name.toLowerCase().indexOf(e)>-1?t.style.display="block":t.style.display="none"}),AOS.refresh()}}function searchOtherGroupByInput(){if(13===(event.which||event.keyCode)){event.preventDefault();let e=event.currentTarget.closest(".search").querySelector("input").value;document.querySelectorAll("#groupPreloading .ContentLoaderCard").forEach(e=>e.classList.remove("hidden")),fetch("/searchNotBelongGroups",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({query:e})}).then(e=>e.json()).then(e=>{200===e.status&&(document.querySelector("#otherGourps .row").innerHTML=e.template,AOS.refresh(),document.querySelectorAll("#groupPreloading .ContentLoaderCard").forEach(e=>e.classList.add("hidden")))})}}function groupUploadSource(){let{group:e,album:t,action:n}=event.currentTarget.dataset,o=event.currentTarget;if(e&&t&&n&&o.files.length){const a=o.files[0],r=new FormData;let i;switch(r.append("file",a),o.closest(".edit-avatar").querySelector("svg").classList.add("active"),n){case"avatar":i=`/upload/group/avatar?group=${e}&album=${t}`;break;case"cover":i=`/upload/group/cover?group=${e}&album=${t}`}fetch(i,{method:"POST",headers:{Accept:"application/json, text/plain, */*","CSRF-Token":$STATE.csrfToken},body:r,withCredentials:!0}).then(e=>e.json()).then(e=>{if(200===e.status){const e=URL.createObjectURL(o.files[0]);switch(o.closest(".edit-avatar").querySelector("svg").classList.remove("active"),o.closest(".edit-avatar").querySelector("img").src=e,o.closest(".edit-avatar").querySelectorAll("picture source").forEach(t=>t.srcset=e),n){case"avatar":document.querySelector(".ProfileCard img").src=e,document.querySelector(".ProfileCard").querySelectorAll("picture source").forEach(t=>t.srcset=e)}}})}}function createPage(){swal({title:`${i18next.t("Page name")}`,input:"text",confirmButtonText:`${i18next.t("Add")}`,background:"rgba(30, 30, 30, .8)"}).then(e=>{e.value&&(showPageLoadingAnimation(),fetch("/createPage",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({name:e.value})}).then(e=>e.json()).then(e=>{hidePageLoadingAnimation(),200===e.status&&e.uid&&(getPage(e.uid),document.querySelector("#page .row").insertAdjacentHTML("afterbegin",`${e.template}`))}))})}function filterPageByInput(){if(13===(event.which||event.keyCode)){event.preventDefault();let e=event.currentTarget.closest(".search").querySelector("input").value.toLowerCase();document.querySelectorAll("#page .ProfileCard").forEach(t=>{t.querySelector(".title").innerText.toLowerCase().indexOf(e)>-1?t.style.display="block":t.style.display="none"}),AOS.refresh()}}function pageUploadSource(){let{page:e,album:t,action:n}=event.currentTarget.dataset,o=event.currentTarget;if(e&&t&&n&&o.files.length){const a=o.files[0],r=new FormData;let i;switch(r.append("file",a),o.closest(".edit-avatar").querySelector("svg").classList.add("active"),n){case"avatar":i=`/changePageAvatar?page=${e}&album=${t}`;break;case"cover":i=`/changePageCover?page=${e}&album=${t}`}fetch(i,{method:"POST",headers:{Accept:"application/json, text/plain, */*","CSRF-Token":$STATE.csrfToken},body:r,withCredentials:!0}).then(e=>e.json()).then(e=>{if(200===e.status){const e=URL.createObjectURL(o.files[0]);switch(o.closest(".edit-avatar").querySelector("svg").classList.remove("active"),o.closest(".edit-avatar").querySelector("img").src=e,o.closest(".edit-avatar").querySelectorAll("picture source").forEach(t=>t.srcset=e),n){case"avatar":document.querySelector(".ProfileCard img").src=e,document.querySelector(".ProfileCard").querySelectorAll("picture source").forEach(t=>t.srcset=e)}}else toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})}}function friendRequest(){let{user:e,action:t}=event.currentTarget.dataset,n=event.currentTarget;disabledTwoSeconds(),e&&t&&(loadingBtn(),fetch("/friend",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({user:e,action:t})}).then(e=>e.json()).then(e=>{if(200===e.status)switch(n.closest(".friend-box")&&n.closest(".friend-box").remove(),n.closest(".ContactCard")&&n.closest(".ContactCard").remove(),t){case"undo":toast({type:"success",title:`${i18next.t("Cancel request successfully")}`});break;case"add":toast({type:"success",title:`${i18next.t("Friend request sent successfully")}`});break;case"reject":toast({type:"success",title:`${i18next.t("Reject request")}`});break;case"accept":toast({type:"success",title:`${i18next.t("Accept request")}`});break;case"unfriend":toast({type:"success",title:`${i18next.t("Deleted")}`})}else toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}function addClock(){Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.3.0/dom/country.txt").then(e=>e.text()).then(e=>{Swal.close(),Swal({html:e,preConfirm:()=>new Promise((e,t)=>{e(document.querySelector('input[name="country"]:checked').value)}),width:930,animation:!0,confirmButtonText:"Select",background:"rgba(30, 30, 30, .8)"}).then(e=>{if(e.value){let t;fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.2.8/json/timezone.json").then(e=>e.json()).then(e=>{t=e}).then(n=>{let o={},a=t.find(t=>t.country_code===e.value);for(let e=0;e<a.timezones.length;e++)o[a.timezones[e]]=a.timezones[e];Swal.fire({title:`${i18next.t("Timezone")}`,input:"select",inputOptions:o,showLoaderOnConfirm:!0,background:"rgba(30, 30, 30, .8)"}).then(e=>{document.getElementById("clocks").insertAdjacentHTML("beforeend",`\n                                    <div class="timer">\n                                        <img src="https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@4.3.1/country_circle_icon/${a.name.split(" ").join("-").toLowerCase()}.webp" alt="">\n                                        <span id="clock3">${moment().tz(e.value).format("H:mm:ss")}</span>\n                                    </div>\n                                `);let t=setInterval(()=>{document.getElementById("clock3")?document.getElementById("clock3").innerHTML=moment().tz(e.value).format("H:mm:ss"):clearInterval(t)},1e3);fetch("/clock/add",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({country:a.country_code,timezone:e.value})})})})}})})}function rmClock(){let e=event.currentTarget,t=e.dataset.uid;t&&swal({title:`${i18next.t("Remove this clock")}`,showCancelButton:!0,confirmButtonColor:"#3085d6",background:"rgba(47, 47, 47, .75)",cancelButtonColor:"#d33",confirmButtonText:`${i18next.t("Yes")}`,cancelButtonText:`${i18next.t("Cancel")}`}).then(n=>{n.value&&e.remove(),fetch("/clock/rm",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:t})})})}function showCountryList(){Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.3.0/dom/country.txt").then(e=>e.text()).then(e=>{Swal.close(),Swal({html:e,preConfirm:()=>new Promise((e,t)=>{e(document.querySelector('input[name="country"]:checked').value)}),width:930,animation:!0,confirmButtonText:"Select",background:"rgba(30, 30, 30, .8)"}).then(e=>{e.value&&(document.querySelectorAll("#newsPreloading .ContentLoaderCard").forEach(e=>e.classList.remove("hidden")),fetch("/news/country",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({country:e.value})}).then(e=>e.json()).then(e=>{document.querySelectorAll("#newsPreloading .ContentLoaderCard").forEach(e=>e.classList.add("hidden")),200===e.status&&(document.getElementById("news").innerHTML=e.template,new Progressive({el:"body",lazyClass:"progressive-img",removePreview:!0,scale:!1}).fire())}))})})}function searchNews(){let e=event.which||event.keyCode,t=event.currentTarget.closest(".search").querySelector("input").value;13===e&&t&&(event.preventDefault(),document.querySelectorAll("#newsPreloading .ContentLoaderCard").forEach(e=>e.classList.remove("hidden")),fetch("/search/news",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({query:t})}).then(e=>e.json()).then(e=>{document.querySelectorAll("#newsPreloading .ContentLoaderCard").forEach(e=>e.classList.add("hidden")),200===e.status&&(document.getElementById("news").innerHTML=e.template),AOS.refresh()}))}function shareNews(){let e=event.currentTarget.dataset.url;if(!e)return;copyToClipboard(e),Swal.mixin({toast:!0,type:"success",position:"bottom-start",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,background:"rgba(47, 47, 47)",didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:"success",title:"Link copied"})}function addTodoItem(){let e=event.currentTarget,t=e.closest(".TodoListCard").querySelector(".todo-container"),n=e.closest(".TodoListCard").querySelector('input[name="todo"]').value,o=e.dataset.isLoading;n&&!o&&(e.closest(".TodoListCard").querySelector('input[name="todo"]').value="",e.closest(".TodoListCard").querySelector('input[name="todo"]').focus(),e.innerHTML='<i class="fa fa-spinner fa-spin"></i>',e.dataset.isLoading="true",fetch("/addTodo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({title:n})}).then(e=>e.json()).then(o=>{t.insertAdjacentHTML("beforeend",`\n                <label class="todo">\n                    <input class="todo__state" type="checkbox" data-uid="${o.uid}" onchange="checkTodo()" />\n                    <svg xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink" viewBox="0 0 250 25" class="todo__icon">\n                        <use xlink:href="#todo__line" class="todo__line"></use>\n                        <use xlink:href="#todo__box" class="todo__box"></use>\n                        <use xlink:href="#todo__check" class="todo__check"></use>\n                        <use xlink:href="#todo__circle" class="todo__circle"></use>\n                    </svg>\n                    <div class="todo__text">${n}</div>\n                    <button type="button" name="button" class="options" data-uid="${o.uid}" onclick="rmTodoItem()"><i class="fas fa-times"></i></button>\n                </label>\n            `),e.innerHTML='<i class="fas fa-plus"></i>',delete e.dataset.isLoading}))}function rmTodoItem(){let e=event.currentTarget.dataset.uid;e&&(event.currentTarget.closest(".todo").remove(),fetch("/rmTodo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})}))}function checkTodo(){let e=event.currentTarget.dataset.uid,t=event.currentTarget.checked;fetch("/checkTodo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,checked:t})})}function getCalendarEvents(){let e=document.getElementById("calendar");calendar=new FullCalendar.Calendar(e,{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,plugins:["interaction","dayGrid","timeGrid"],defaultView:"dayGridMonth",defaultDate:new Date,header:{left:"createCal, prev, next today",center:"title",right:"dayGridMonth, timeGridWeek, timeGridDay"},customButtons:{createCal:{text:"+",click:()=>calendarFormShow()}},editable:!1,droppable:!1,events:{url:"/event/me/today",method:"GET",extraParams:{},success:e=>(calendar.timezone=e.timeZone,e.template?document.querySelector("#events").insertAdjacentHTML("beforeend",e.template):document.getElementById("no-event").classList.remove("hidden"),e.events),failure:e=>{toast({type:"error",title:"Not able to fetch calendar events"})}},eventClick:e=>{moment(new Date(document.getElementById("events").dataset.selecteddate)).isSame(moment(new Date(e.event.start)))||fetch(`/event/me?start=${e.event.start}`,{method:"GET",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(t=>{200===t.status&&t.template?(document.getElementById("no-event").classList.add("hidden"),document.getElementById("events").dataset.selecteddate=moment(new Date(e.event.start)),document.querySelectorAll("#events .EventCard").forEach(e=>e.remove()),document.querySelector("#events").insertAdjacentHTML("beforeend",t.template)):document.getElementById("no-event").classList.remove("hidden")})},dateClick:e=>{calendarFormShow();let t=new Date(e.dateStr);function n(e){let t=e.getDate();t<10&&(t="0"+t);let n=e.getMonth()+1;return n<10&&(n="0"+n),t+" / "+n+" / "+e.getFullYear()}document.querySelector("#cal-start-date .selected-date").dataset.date=e.dateStr,document.querySelector("#cal-start-date .selected-date").textContent=n(t),document.querySelector("#cal-end-date .selected-date").dataset.date=e.dateStr,document.querySelector("#cal-end-date .selected-date").textContent=n(t)},dayRender:()=>{}}),calendar.render(),initCalDatePicker()}function initCalDatePicker(){document.querySelectorAll(".cal-picker-container").forEach(e=>{const t=e.querySelector(".date-picker"),n=e.querySelector(".date-picker .selected-date"),o=e.querySelector(".date-picker .dates"),a=e.querySelector(".date-picker .dates .month .mth"),r=e.querySelector(".date-picker .dates .month .next-mth"),i=e.querySelector(".date-picker .dates .month .prev-mth"),s=e.querySelector(".date-picker .dates .days"),c=["January","February","March","April","May","June","July","August","September","October","November","December"];let l=new Date,d=l.getDate(),u=l.getMonth(),m=l.getFullYear(),p=l,g=d,h=u,v=m;function f(e){s.innerHTML="";let t=31;1==u&&(t=28);for(let e=0;e<t;e++){const t=document.createElement("div");t.classList.add("day"),t.textContent=e+1,g==e+1&&v==m&&h==u&&t.classList.add("selected"),t.addEventListener("click",function(){p=new Date(m+"-"+(u+1)+"-"+(e+1)),g=e+1,h=u,v=m,n.textContent=T(p),n.dataset.date=y(p),f()}),s.appendChild(t)}}function y(e){let t=e.getDate();t<10&&(t="0"+t);let n=e.getMonth()+1;return n<10&&(n="0"+n),`${e.getFullYear()}-${n}-${t}`}function T(e){let t=e.getDate();t<10&&(t="0"+t);let n=e.getMonth()+1;return n<10&&(n="0"+n),t+" / "+n+" / "+e.getFullYear()}a.textContent=c[u]+" "+m,n.textContent=T(l),n.dataset.date=y(l),f(),t.addEventListener("click",function(e){(function(e,t){for(let n=0;n<e.length;n++)if(e[n].classList&&e[n].classList.contains(t))return!0;return!1})(e.path,"dates")||o.classList.toggle("active")}),r.addEventListener("click",function(e){++u>11&&(u=0,m++);a.textContent=c[u]+" "+m,f()}),i.addEventListener("click",function(e){--u<0&&(u=11,m--);a.textContent=c[u]+" "+m,f()});const S=e.querySelector(".time-picker"),b=e.querySelector(".time-picker .hour .hr"),C=e.querySelector(".time-picker .minute .min"),w=e.querySelector(".time-picker .hour .hr-up"),A=e.querySelector(".time-picker .hour .hr-down"),k=e.querySelector(".time-picker .minute .min-up"),x=e.querySelector(".time-picker .minute .min-down");let $=new Date,L=$.getHours(),q=$.getMinutes();function E(){b.value=M(L),C.value=M(q),S.dataset.time=M(L)+":"+M(q)}function M(e){return e<10&&(e="0"+e),e}b.value=M(0),C.value=M(0),S.dataset.time="00:00",w.addEventListener("click",function(){++L>23&&(L=0);E()}),A.addEventListener("click",function(){--L<0&&(L=23);E()}),k.addEventListener("click",function(){++q>59&&(q=0,L++);E()}),x.addEventListener("click",function(){--q<0&&(q=59,L--);E()}),b.addEventListener("change",function(e){e.target.value>23?e.target.value=23:e.target.value<0&&(e.target.value="00");""==e.target.value&&(e.target.value=M(L));L=e.target.value}),C.addEventListener("change",function(e){e.target.value>59?e.target.value=59:e.target.value<0&&(e.target.value="00");""==e.target.value&&(e.target.value=M(q));q=e.target.value})}),document.getElementById("calAllDay").checked=!0}function calAllDay(e){e.checked?(document.querySelector("#cal-start-date .time-picker").style.display="none",document.querySelector("#cal-end-date .time-picker").style.display="none"):(document.querySelector("#cal-start-date .time-picker").style.display="flex",document.querySelector("#cal-end-date .time-picker").style.display="flex")}function calendarFormShow(){document.getElementById("calendarForm").classList.toggle("active")}function createCal(){let e=document.querySelector('#calendarForm input[name="title"]').value,t=document.querySelector('#calendarForm textarea[name="desc"]').value,n=document.querySelector("#calAllDay").checked,o=document.querySelector("#cal-start-date .selected-date").dataset.date,a=document.querySelector("#cal-start-date .time-picker").dataset.time,r=n?new Date(`${o}`):new Date(`${o}T${a}`),i=document.querySelector("#cal-end-date .selected-date").dataset.date,s=document.querySelector("#cal-end-date .time-picker").dataset.time,c=n?new Date(`${i}`):new Date(`${i}T${s}`),l=document.querySelector('#calendarForm input[name="color"]:checked').value,d=6e4*r.getTimezoneOffset();e&&r&&c&&l&&(document.getElementById("calendarForm").classList.remove("active"),initCalDatePicker(),document.querySelector('#calendarForm input[name="title"]').value="",document.querySelector('#calendarForm textarea[name="desc"]').value="",fetch("/calendar/add",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({title:e,desc:t,title:e,start:r,end:c,color:l,allDay:n})}).then(e=>e.json()).then(o=>{if(200===o.status){calendar.addEvent({id:o.uid,title:e,desc:t,title:e,start:new Date(r.getTime()-d),end:new Date(c.getTime()-d),color:l,allDay:n});let a=moment(new Date).isSame(moment(new Date(r)),"day");document.getElementById("no-event").classList.contains("hidden")||document.getElementById("no-event").classList.add("hidden"),a&&document.querySelector("#events").insertAdjacentHTML("beforeend",o.template)}}))}function rmCalEvent(){let e=event.currentTarget.dataset.uid;if(e){disabledTwoSeconds(),document.querySelectorAll(`[data-event="${e}"]`).forEach(e=>e.remove());calendar.getEvents();let t=calendar.getEventById(e);t&&t.remove(),0===calendar.getEvents().length&&document.getElementById("no-event").classList.remove("hidden"),fetch("/calendar/remove",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})})}}function editPost(){let{uid:e,category:t}=event.currentTarget.dataset;disabledTwoSeconds(),e&&t&&(showPageLoadingAnimation(),fetch("/post/edit",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,category:t})}).then(e=>e.json()).then(e=>{hidePageLoadingAnimation(),200===e.status&&(document.body.insertAdjacentHTML("beforeend",e.template),document.querySelector("#editPosterForm .content").focus(),document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd())}))}function rmPost(){let{uid:e,category:t}=event.currentTarget.dataset;disabledTwoSeconds(),e&&t&&swal({title:`${i18next.t("Are you sure")}`,text:`${i18next.t("You wont be able to revert this")}`,type:"warning",showCancelButton:!0,background:"rgba(47, 47, 47, .75)",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`}).then(n=>{n.value&&(document.querySelectorAll(`[data-post="${e}"]`).forEach(e=>e.remove()),fetch("/post/remove",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,category:t})}))})}function rmPostComment(){let e=event.currentTarget.closest(".PostCard"),t=e.querySelector('.option-btns-container button[name="comment"] .number'),{post:n,uid:o,category:a}=event.currentTarget.dataset,r=event.currentTarget.closest(".comment");if(n&&o&&a){r.remove();let i=parseInt(t.textContent,10);t.textContent=i-1,[...e.querySelectorAll(".comment")].some(e=>e.dataset.user===$STATE.user.uid)||e.querySelector('.option-btns-container button[name="comment"]').classList.remove("commented"),fetch("/rmComment",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({post:n,uid:o,category:a})})}}function createUserPost(){let e=event.which||event.keyCode;if(13===e&&event.shiftKey&&(event.preventDefault(),document.execCommand("insertHTML",!1,"<br> </br>")),13==e&&!event.shiftKey){event.preventDefault();let e=document.querySelector("#userPosterForm .content").innerHTML,t=DOMPurify.sanitize(`${e}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["style"]}),n=[...document.querySelectorAll("#userPosterForm [data-img]")].map(e=>({uid:e.dataset.uid,image:e.dataset.img,type:"image"})),o=[...document.querySelectorAll("#userPosterForm [data-video]")].map(e=>({uid:e.dataset.uid,video:e.dataset.video,thumbnail:e.dataset.thumbnail,type:"video"})),a=n.concat(o),r=document.querySelectorAll("#newPostFriendTag option:checked"),i=Array.from(r).map(e=>e.value),s=[...document.querySelectorAll("#userPosterForm ._geo")].map(e=>({lat:e.dataset.lat,lng:e.dataset.lng})),c=document.querySelector('#userPosterForm select[name="status"]'),l=c.options[c.selectedIndex].value;(e||a.length)&&(showPageLoadingAnimation(),fetch("/post/add/user",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({content:t,sources:a,friendTags:i,geo:s,status:l})}).then(e=>e.json()).then(e=>{hidePageLoadingAnimation(),200===e.status&&(document.getElementById("myPostsResult").insertAdjacentHTML("afterbegin",`${e.template}`),document.querySelector("#userPosterForm .content").innerHTML="",document.querySelector("#userPosterForm .image-list").innerHTML="",[...document.querySelectorAll("#userPosterForm [data-img], #userPosterForm [data-video]")].forEach(e=>e.remove()),refreshFsLightbox(),setfsLightboxProps())}))}}function updatePost(){let{uid:e,category:t}=event.currentTarget.dataset,n=event.which||event.keyCode;if(13===n&&event.shiftKey&&(event.preventDefault(),document.execCommand("insertHTML",!1,"<br> </br>")),13==n&&!event.shiftKey){let n;event.preventDefault();let o=document.querySelector("#editPosterForm .content").innerHTML,a=DOMPurify.sanitize(`${o}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["style"]});if(document.querySelector('#editPosterForm select[name="status"]')){let e=document.querySelector('#editPosterForm select[name="status"]');n=e.options[e.selectedIndex].value}o&&(event.currentTarget.closest(".popupCover").remove(),document.body.click(),fetch("/post/update",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,category:t,content:a,status:n})}),document.querySelectorAll(`.PostCard[data-post="${e}"]`).forEach(e=>{if(e.querySelector(".content").innerHTML=a,e.querySelector(".status"))switch(n){case"public":e.querySelector(".status").innerHTML='<i class="fas fa-users"></i>';break;case"friend":e.querySelector(".status").innerHTML='<i class="fas fa-user-friends"></i>';break;case"private":e.querySelector(".status").innerHTML='<i class="fas fa-lock"></i>'}}))}}function createCommentForm(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let{uid:e,category:t}=event.currentTarget.dataset;if(!event.currentTarget.closest(".PostCard").querySelector(".pre_comment")){let n;switch(t){case"user":n=event.currentTarget.dataset.name,switchUsersListToggleFn="";break;case"group":n=event.currentTarget.dataset.group,switchUsersListToggleFn=""}event.currentTarget.closest(".PostCard").querySelector(".comments").insertAdjacentHTML("afterbegin",`\n                <div class="pre_comment" data-post="${e}">\n                    <div class="avatar" ${switchUsersListToggleFn}>\n                        <img src="/images/UserAlbum/${$STATE.userDefaultAlbums.avatar}/${$STATE.user.avatar}" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" />\n                    </div>\n\n                    <div class="msg">\n                        <div class="tri"></div>\n                        <div class="msg_inner">\n                            <aside class="message-input-wrapper">\n                                <div class="emoji-picker-menu hidden"></div>\n                                <div class="content" contentEditable="true" data-post="${e}" data-name="${$STATE.user.nickname||$STATE.user.name}" data-commenter="${$STATE.user.uid}"  data-${t}="${n}" data-uid="${e}" data-category="${t}" data-comment-category="user" onkeypress="contenteditableRichText(); sendComment()"></div>\n                                <ul class="image-list"></ul>\n                                <div class="setting-list">\n                                    <button type="button" name="button" class="emoji-picker-btn" onclick="emojiPickerMenuToggle()">\n                                        <i class="fas fa-meh-blank"></i>\n                                        <span class="tooltip-top">${i18next.t("Emoji")}</span>\n                                    </button>\n                                    <button type="button" name="button" class="emoji-picker-btn" onclick="commentFileIuputToggle(this)">\n                                        <i class="fas fa-photo-video"></i>\n                                        <span class="tooltip-top">${i18next.t("Image")}</span>\n                                    </button>\n                                    <input type="file" class="hidden" onchange="commentFileIuputChange()" accept="image/*" multiple />\n                                </div>\n                            </aside>\n                        </div>\n                    </div>\n                </div>\n            `)}event.currentTarget.closest(".PostCard").querySelector(".pre_comment .content").focus()}}function commentFileIuputChange(){let e=event.currentTarget;for(let t=0;t<e.files.length;t++){const n=e.files[t],o=URL.createObjectURL(n),a=uuid();let r=new FormData;r.append("file",n),r.append("preloadImgUid",a),n.type.match("image")?e.closest(".message-input-wrapper").querySelector(".image-list").insertAdjacentHTML("beforeend",`\n                <li>\n                    <img src="${o}" class="loading" id="image-${a}" alt="Image not found" onerror="imageNotFound(this)" />\n                    <svg id="progress-${a}" version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                        <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                        <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                    </svg>\n                </li>\n            `):e.closest(".message-input-wrapper").querySelector(".image-list").insertAdjacentHTML("beforeend",`\n                <li>\n                    <video src="${o}" class="lozad loading" id="image-${a}" controlsList="nodownload" loop muted></video>\n                    <svg id="progress-${a}" version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                        <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                        <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                    </svg>\n                </li>\n            `),axios({method:"post",url:`/upload/comment?preloadImgUid=${a}`,data:r,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let t=(e.loaded/e.total*100).toFixed(2),n=document.querySelector(`#progress-${a} .circle`).getTotalLength();!function(){if(100===t)return;let e=n/100*(t=100-t);document.querySelector(`#progress-${a} .circle`).style["stroke-dashoffset"]=e}()}}}).then(t=>{document.querySelector(`#image-${a}`).classList.remove("loading"),document.querySelector(`#progress-${a}`).remove(),e.closest(".pre_comment").insertAdjacentHTML("afterbegin",`<div data-uid="${t.data.uid}" data-img="${t.data.convertedImg}"></div>`)})}}function sendComment(){let e=event.which||event.keyCode;if(13===e&&event.shiftKey&&(event.preventDefault(),document.execCommand("insertHTML",!1,"<br> </br>")),13==e&&!event.shiftKey){event.preventDefault();let e=event.currentTarget.closest(".PostCard"),{uid:t,commenter:n,commentCategory:o,category:a}=event.currentTarget.dataset,r=event.currentTarget.closest(".pre_comment").querySelector(".content").innerHTML,i=(DOMPurify.sanitize(`${r}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["inputstyle"]}),[...event.currentTarget.closest(".pre_comment").querySelectorAll("[data-img]")].map(e=>({uid:e.dataset.uid,image:e.dataset.img,type:"image"}))),s=[...event.currentTarget.closest(".pre_comment").querySelectorAll("[data-video]")].map(e=>({uid:e.dataset.uid,video:e.dataset.video,thumbnail:e.dataset.thumbnail,type:"video"})),c=i.concat(s),l=event.currentTarget.closest(".pre_comment"),d=(event.currentTarget.dataset.name,event.currentTarget.closest(".pre_comment").querySelector(".avatar img").src,(e,t)=>!(!e&&!t.length));t&&a&&d(r,c)&&(e.dataset.isloading="true",fetch("/comment",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:t,commenter:n,commentCategory:o,content:r,sources:c,category:a})}).then(e=>e.json()).then(t=>{if(200===t.status){e.dataset.isloading="false";let n=parseInt(e.querySelector('.option-btns-container button[name="comment"] .number').textContent,10);e.querySelector('.option-btns-container button[name="comment"] .number').textContent=n+1,e.querySelector('.option-btns-container button[name="comment"]').classList.add("commented"),e.querySelector('.option-btns-container button[name="comment"] i').classList.add("heartBeatAnimation"),e.querySelector(".comments").insertAdjacentHTML("afterbegin",t.template),l.remove(),refreshFsLightbox(),setfsLightboxProps()}}))}}function postLike(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let{uid:e,category:t}=event.currentTarget.dataset,n=event.currentTarget.classList.contains("liked");if(e&&t){if(n){let e=parseInt(event.currentTarget.querySelector(".number").textContent,10);event.currentTarget.querySelector(".number").textContent=e-1,event.currentTarget.classList.remove("liked"),event.currentTarget.querySelector("i").classList.remove("heartBeatAnimation")}else{let e=parseInt(event.currentTarget.querySelector(".number").textContent,10);event.currentTarget.querySelector(".number").textContent=e+1,event.currentTarget.classList.add("liked"),event.currentTarget.querySelector("i").classList.add("heartBeatAnimation")}fetch("/post/like",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,category:t,status:!n})})}}}function postShare(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let{uid:e,category:t}=event.currentTarget.dataset,n=event.currentTarget.classList.contains("shared");if(e&&t){if(n){let e=parseInt(event.currentTarget.querySelector(".number").textContent,10);event.currentTarget.querySelector(".number").textContent=e-1,event.currentTarget.classList.remove("shared"),event.currentTarget.querySelector("i").classList.remove("heartBeatAnimation")}else{let e=parseInt(event.currentTarget.querySelector(".number").textContent,10);event.currentTarget.querySelector(".number").textContent=e+1,event.currentTarget.classList.add("shared"),event.currentTarget.querySelector("i").classList.add("heartBeatAnimation")}fetch("/post/share",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,category:t,status:!n})})}}}function createAlbum(){let e=event.currentTarget,t=event.currentTarget.dataset.category;t&&swal({title:`${i18next.t("Create new album")}`,text:`${i18next.t("Give your album a special name")}`,input:"text",showCancelButton:!0,confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`,showLoaderOnConfirm:!0,background:"rgba(30, 30, 30, .8)"}).then(n=>{if(n.value)switch(t){case"user":fetch("/album/create",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({title:n.value,category:t})}).then(e=>e.json()).then(e=>{200===e.status&&document.querySelector("#myAlbum .row").insertAdjacentHTML("afterbegin",`${e.template}`)});break;case"group":let o=e.dataset.group;o&&fetch("/album/create",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({title:n.value,group:o,category:t})}).then(e=>e.json()).then(e=>{200===e.status&&document.querySelector("#group-album .row").insertAdjacentHTML("afterbegin",`${e.template}`)})}})}function rmSource(){let{album:e,source:t,category:n}=event.currentTarget.dataset,o=event.currentTarget.closest(".album-container");e&&t&&n&&swal({title:`${i18next.t("Are you sure")}`,text:`${i18next.t("You wont be able to revert this")}`,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",background:"rgba(47, 47, 47, .75)",cancelButtonColor:"#d33",confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`}).then(a=>{a.value&&e&&t&&n&&(loadingBtn(),fetch("/rmSource",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({album:e,source:t,category:n})}).then(e=>e.json()).then(e=>{200===e.status?o.remove():toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))})}function filterMyFriendByInput(){if(13===(event.which||event.keyCode)){event.preventDefault();let e=event.currentTarget.closest(".search").querySelector("input").value.toLowerCase();document.querySelectorAll("#myFriends .ContactCard").forEach(t=>{t.style.display=t.dataset.name.toLowerCase().indexOf(e)>-1?"block":"none"}),AOS.refresh()}}async function addFriendFormToggle(){const{value:e}=await Swal.fire({title:"Add friend",input:"email",inputPlaceholder:"Enter your friend's email",background:"rgba(47, 47, 47, .75)"});e&&fetch("/friend",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({user:e,action:"send"})}).then(e=>e.json()).then(e=>{200===e.status?toast({type:"success",title:`${i18next.t("Friend request sent successfully")}`}):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})}function filterVideoByInput(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{if(13===(event.which||event.keyCode)){event.preventDefault();let e=event.currentTarget.value,t='<div class="card-loader"><span class="desc"></span></div>'.repeat(12);document.getElementById("lobby-result").innerHTML=`<div class="videos">${t}</div>`,fetch("/searchTrantube",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({query:e})}).then(e=>e.json()).then(e=>{hidePageLoadingAnimation(),200===e.status&&(videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.dispose()),document.getElementById("lobby-result").innerHTML=e.template,disableVideoControl(),AOS.refresh(),discover())})}}}function trantubeTab(){let e=event.currentTarget.dataset.href;if($STATE.isGuest&&!["home","podcast"].includes(e))return;document.querySelectorAll("#lobby li[data-href]").forEach(e=>{e.classList.contains("selected")&&e.classList.remove("selected")}),videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.dispose()),event.currentTarget.classList.add("selected");let t='<div class="card-loader"><span class="desc"></span></div>'.repeat(12);document.getElementById("lobby-result").innerHTML=`<div class="videos">${t}</div>`,document.getElementById("lobby-saerch")&&(document.getElementById("lobby-saerch").value="")}function getChannel(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let e=arguments[0]?arguments[0]:event.currentTarget.dataset.channel;if(e){videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.dispose()),discover();let t='<div class="card-loader"><span class="desc"></span></div>'.repeat(12);document.getElementById("lobby-result").innerHTML=`<div class="videos">${t}</div>`,document.getElementById("lobby-saerch")&&(document.getElementById("lobby-saerch").value=""),fetch("/getChannel",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({channel:e})}).then(e=>e.json()).then(t=>{200===t.status&&(document.getElementById("lobby-result").innerHTML=t.template),disableVideoControl(),preventVideoRightClick(),tabReflash(),tableReflash(),window.history.pushState("","",`/channel?uid=${e}`)})}}}function getMyChannel(){$STATE.isGuest?toast({type:"error",title:`${i18next.t("Please login to continue")}`}):fetch("/getMyChannel",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("lobby-result").innerHTML=e.template,tabReflash(),tableReflash())})}function getLive(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.dispose()),discover();let e='<div class="card-loader"><span class="desc"></span></div>'.repeat(12);document.getElementById("lobby-result").innerHTML=`<div class="videos">${e}</div>`,document.getElementById("lobby-saerch")&&(document.getElementById("lobby-saerch").value=""),fetch("/getLive",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("lobby-result").innerHTML=e.template),window.history.pushState("","","/live")})}}function showLive(){document.querySelector(".main-container").classList.add("show"),document.querySelector(".vid-container .sidebar").style.cssText="width: 0; margin: 0; padding: 0; visibility: hidden;",document.getElementById("close-video").style.cssText="visibility: visible;",navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(e=>{var t=document.getElementById("video");t.srcObject=e;let n=videojs("video",{autoplay:!0,live:!0,liveui:!0});n.src({type:"video/mp4",src:`/v?category=Trantube&uid=${t}`}),n.play()}).catch(function(e){console.log("Error in getting stream",e)}),window.scrollTo(0,0)}function getLobby(){fetch("/getLobby",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("lobby-result").innerHTML=e.template,window.history.pushState("","","/watch"))})}function getSubscriptions(){$STATE.isGuest?toast({type:"error",title:`${i18next.t("Please login to continue")}`}):fetch("/getSubscriptions",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("lobby-result").innerHTML=e.template)})}function createChannel(){swal({title:`${i18next.t("Channel name")}`,input:"text",confirmButtonText:`${i18next.t("Add")}`,background:"rgba(30, 30, 30, .8)"}).then(e=>{e.value&&(showPageLoadingAnimation(),fetch("/channel/create",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({channel:e.value})}).then(e=>e.json()).then(e=>{hidePageLoadingAnimation()}))})}function changeChannelName(){let e=event.currentTarget.dataset.channel,t=event.currentTarget.value;13===(event.which||event.keyCode)&&e&&t&&(event.preventDefault(),fetch("/changeChannelName",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({channel:e,name:t})}),toast({type:"success",title:`${i18next.t("Update successfully")}`}))}function changeChannelDesc(){let e=event.currentTarget.dataset.channel,t=event.currentTarget.value;13===(event.which||event.keyCode)&&e&&t&&(event.preventDefault(),fetch("/changeChannelDesc",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({channel:e,desc:t})}),toast({type:"success",title:`${i18next.t("Update successfully")}`}))}function displayMembers(){let e=event.currentTarget.dataset.group,t=event.currentTarget.classList.contains("on")?0:1;e&&(fetch("/groupUpdateDisplayMembersSetting",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:e,status:t})}),t?event.currentTarget.classList.add("on"):event.currentTarget.classList.remove("on"))}function updateGroupName(){let e=event.currentTarget.dataset.group,t=event.currentTarget.value;13===(event.which||event.keyCode)&&(event.preventDefault(),e&&t&&(fetch("/updateGroupInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:e,name:t,action:"change_name"})}),toast({type:"success",title:`${i18next.t("Update successfully")}`})))}function updateGroupDesc(){let e=event.currentTarget.dataset.group,t=event.currentTarget.value;13===(event.which||event.keyCode)&&(event.preventDefault(),e&&t&&(fetch("/updateGroupInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:e,desc:t,action:"change_desc"})}),toast({type:"success",title:`${i18next.t("Update successfully")}`})))}function inviteGroupFormSubmit(e){let t=e.dataset.group,n=JSON.parse(document.querySelector("#inviteGroupForm input[name=tags]").value).map(e=>e.value);t&&n&&(fetch("/inviteGroup",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:t,members:n})}),toast({type:"success",title:`${i18next.t("Send invite")}`}),document.getElementById("inviteGroupForm").remove())}function groupRequest(){disabledTwoSeconds();let{group:e,action:t}=event.currentTarget.dataset;if(e&&t){switch(loadingBtn(),fetch("/groupRequest",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:e,user:$STATE.user.uid,action:t})}),t){case"add":toast({type:"success",title:`${i18next.t("Add new member successfully")}`});break;case"reject":toast({type:"success",title:`${i18next.t("Cancel group request successfully")}`});break;case"rmInvite":toast({type:"success",title:`${i18next.t("Cancel invite")}`});break;case"join":toast({type:"success",title:`${i18next.t("Send group request successfully")}`});break;case"cancelJoin":toast({type:"success",title:`${i18next.t("Cancel group request successfully")}`});break;case"acceptInvite":toast({type:"success",title:`${i18next.t("Add group successfully")}`});break;default:toast({type:"error",title:`${i18next.t("Wrong action request")}`})}event.currentTarget.closest(".GroupCard").remove()}}function groupMemberRequest(){let{group:e,user:t}=event.currentTarget.dataset,n=event.currentTarget.value,o=event.currentTarget.closest("td"),a=event.currentTarget.closest("tr"),r=event.currentTarget.closest("tr").querySelectorAll(".member-info p")[1];e&&t&&n&&(o.innerHTML='\n            <svg version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink" x="0px" y="0px" width="1em" height="1em" viewBox="0 0 50 50" xml:space="preserve">\n                <path fill="var(--theme-color)" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z">\n                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite" />\n                </path>\n            </svg>\n        ',fetch("/groupMemberRequest",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:e,user:t,action:n})}).then(e=>e.json()).then(i=>{if(200===i.status)switch(n){case"add":o.innerHTML=`\n                            <span class="status-text status-green">active</span>\n                            <select class="action-box" data-group="${e}" data-user="${t}" onchange="groupMemberRequest()">\n                                <option value="" disabled selected hidden>Actions</option>\n                                <option value="beAdmin">Make admin</option>\n                                <option value="remove">Remove from group</option>\n                            </select>\n                        `;break;case"reject":case"remove":case"rmInvite":a.remove();break;case"beNormal":t===$STATE.user.uid?getGroup(e):(r.innerText="normal",o.innerHTML=`\n                                <span class="status-text status-green">active</span>\n                                <select class="action-box" data-group="${e}" data-user="${t}" onchange="groupMemberRequest()">\n                                    <option value="" disabled selected hidden>Actions</option>\n                                    <option value="beAdmin">Make admin</option>\n                                    <option value="remove">Remove from group</option>\n                                </select>\n                            `);break;case"beAdmin":t===$STATE.user.uid?getGroup(e):(r.innerText="admin",o.innerHTML=`\n                                <span class="status-text status-green">active</span>\n                                <select class="action-box" data-group="${e}" data-user="${t}" onchange="groupMemberRequest()">\n                                    <option value="" disabled selected hidden>Actions</option>\n                                    <option value="beNormal">Remove as admin</option>\n                                    <option value="remove">Remove from group</option>\n                                </select>\n                            `)}}))}function createGroupPost(){let e=event.which||event.keyCode;if(13===e&&event.shiftKey&&(event.preventDefault(),document.execCommand("insertHTML",!1,"<br> </br>")),13==e&&!event.shiftKey){event.preventDefault();let e=event.currentTarget.dataset.group,t=document.querySelector("#groupPosterForm .content").innerHTML,n=DOMPurify.sanitize(`${t}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["style"]}),o=[...document.querySelectorAll("#groupPosterForm [data-img]")].map(e=>({uid:e.dataset.uid,image:e.dataset.img,type:"image"})),a=[...document.querySelectorAll("#groupPosterForm [data-video]")].map(e=>({uid:e.dataset.uid,video:e.dataset.video,thumbnail:e.dataset.thumbnail,type:"video"})),r=o.concat(a),i=[...document.querySelectorAll("#groupPosterForm ._geo")].map(e=>({lat:e.dataset.lat,lng:e.dataset.lng,country:e.dataset.country}));e&&t||r.length?(showPageLoadingAnimation(),fetch("/post/add/group",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({group:e,content:n,sources:r,geo:i})}).then(e=>e.json()).then(t=>{200===t.status?(document.getElementById("groupPosterForm").remove(),hidePageLoadingAnimation(),getGroup(e)):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})):toast({type:"error",title:`${i18next.t("Please add content or image")}`})}}function filterAlbumByInput(){let e=event.which||event.keyCode,t=event.currentTarget.dataset.category;if(13===e){event.preventDefault();let e=event.currentTarget.closest(".search").querySelector("input").value.toLowerCase();switch(t){case"user":document.querySelectorAll("#myAlbum .album-container").forEach(t=>{let n=t.querySelector(".desc").innerText;t.style.display=n.toLowerCase().indexOf(e)>-1?"block":"none"});break;case"group":document.querySelectorAll("#group-album .album-container").forEach(t=>{let n=t.querySelector(".desc").innerText;t.style.display=n.toLowerCase().indexOf(e)>-1?"block":"none"})}}}function getVideo(){let e=arguments[0]?arguments[0]:event.currentTarget.dataset.video;e&&(showAppLoading(),fetch("/watch",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({video:e})}).then(e=>e.json()).then(t=>{if(200===t.status){showAppContent(t.template),preventVideoRightClick(),getVideoRelated(),document.querySelector(".main-container").classList.add("show"),document.querySelector(".vid-container .sidebar").style.cssText="width: 0; margin: 0; padding: 0; visibility: hidden;",document.getElementById("close-video").style.cssText="visibility: visible;";videojs("video");videojs("video").play(),window.history.pushState("","",`/watch?uid=${e}`)}else toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}function getUploadVideoForm(){let e='<div class="card-loader"><span class="desc"></span></div>'.repeat(12);document.getElementById("lobby-result").innerHTML=`<div class="videos">${e}</div>`,fetch("/getUploadVideoForm",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("lobby-result").innerHTML=e.template,previewTrantubeUpload(),AOS.refresh(),discover())})}function preventVideoRightClick(){document.querySelectorAll("video").forEach(e=>{e.addEventListener?e.addEventListener("contextmenu",e=>e.preventDefault(),!1):e.attachEvent("oncontextmenu",()=>window.event.returnValue=!1)})}function uploadTrantubeFile(){let e=document.querySelector('#uploadVideoForm input[name="channel"]:checked').value,t=document.getElementById("video-title").value,n=document.getElementById("video-desc").value,o=document.getElementById("set-video-seconds"),a=o.options[o.selectedIndex].value,r=document.getElementById("uploadVideoInput").files[0];if(r.size>1e8)toast({type:"error",title:`${i18next.t("Maximum file size is 100MB")}`});else if(e&&r&&t&&a){document.getElementById("uploadVideoBtn");loadingBtn();let o=new FormData;o.append("trantube",r),o.append("channel",e),o.append("title",t),o.append("desc",n),o.append("status",status),o.append("thumbnailSeconds",a),axios({method:"post",url:"/upload/video",data:o,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let t=Math.floor(e.loaded/e.total*100);document.getElementById("uploadVideoProgress").value=Math.round(t),document.getElementById("status").innerHTML=Math.round(t)+"% uploaded... please wait",document.querySelector('#lobby .user-settings button[name="video"]').innerHTML=`<i class="fa fa-spinner fa-spin"></i> ${t} %`}}}).then(e=>{toast({type:"success",title:`${i18next.t("Update successful")}`}),window.location.replace("/watch")})}else toast({type:"error",title:`${i18next.t("Please fill in required fields")}`})}function rmVideo(){let e=event.currentTarget.closest("tr"),t=event.currentTarget.dataset.uid;fetch("/video/remove",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:t})}).then(e=>e.json()).then(t=>{200===t.status?e.remove():toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})}function createVideoSettingForm(){let e=event.currentTarget.dataset.uid;fetch("/video/info",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})}).then(e=>e.json()).then(t=>{200===t.status&&Swal({html:`\n                    <h4>${i18next.t("Title")}</h4>\n                    <input type="text" name="title" value="${t.title}" id="update-video-title">\n                    <h4>${i18next.t("Description")}</h4>\n                    <textarea name="desc" rows="6" cols="80" id="update-video-desc">${t.desc}</textarea>\n                    <h4>${i18next.t("Status")}</h4>\n                    <div class="select-wrapper">\n                        <select name="status" id="update-video-status">\n                            <option value="public" selected>${i18next.t("Public")}</option>\n                            <option value="private">${i18next.t("Only me")}</option>\n                        </select>\n                    </div>\n                `,width:600,animation:!0,showConfirmButton:!0,showCancelButton:!0,confirmButtonText:`${i18next.t("Update")}`,cancelButtonText:`${i18next.t("Cancel")}`,background:"rgba(30, 30, 30, .8)"}).then(t=>{if(t.value){let t=document.getElementById("update-video-title").value,n=document.getElementById("update-video-desc").value,o=document.getElementById("update-video-status").value;fetch("/video/update",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,title:t,desc:n,status:o})}),toast({type:"success",title:`${i18next.t("Update successfully")}`})}})})}function disableVideoControl(){document.querySelectorAll(".video").forEach(e=>{e.addEventListener("mouseover",()=>{e.querySelector("video")&&e.querySelector("video").play()}),e.addEventListener("mouseleave",()=>{e.querySelector("video")&&e.querySelector("video").pause()})})}function uploadMusicTrigger(){document.getElementById("trantube-music-input").click()}function uploadMusic(){let e=new FormData;for(let t=0;t<document.getElementById("trantube-music-input").files.length;t++)e.append("file",document.getElementById("trantube-music-input").files[t]);axios({method:"post",url:"/upload/music",data:e,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let t=Math.floor(e.loaded/e.total*100);document.querySelector('#lobby .user-settings button[name="music"]').innerHTML=`<i class="fa fa-spinner fa-spin"></i> ${t} %`}}}).then(e=>{let t="";for(let n=0;n<e.data.files.length;n++)t+=`\n                <tr>\n                    <td data-uid="${e.data.files[n].uid}" onclick="playOneMusic()">${e.data.files[n].title}</td>\n                    <td data-uid="${e.data.files[n].uid}" onclick="playOneMusic()">${e.data.files[n].duration}</td>\n                    <td>\n                        <div class="options">\n                            <label for="${e.data.files[n].uid}"><i class="fas fa-ellipsis-h"></i></label>\n                            <input type="checkbox" id="${e.data.files[n].uid}">\n                            <div class="Option_Menu">\n                                <ul class="more-items">\n                                    <li class="delete" data-uid="${e.data.files[n].uid}" onclick="rmMusic()"><i class="fas fa-trash-alt"></i>${i18next.t("Delete")}</li>\n                                </ul>\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `;document.querySelector("#trantube-music-list tbody").insertAdjacentHTML("afterbegin",`${t}`),document.querySelector('#lobby .user-settings button[name="music"]').innerHTML='\n            <svg xmlns="https://www.w3.org/2000/svg" stroke="currentColor" viewBox="0 0 512.06 512.06">\n                <path\n                    d="M426.63 188.22C402.97 93.95 307.37 36.7 213.08 60.37A176 176 0 0080.39 218.3a96 96 0 0016 190.72h80v-32h-80a64 64 0 010-128 16 16 0 0016-16c-.08-79.53 64.33-144.06 143.86-144.14a144 144 0 01141.42 116.14 16 16 0 0013.6 12.8 80 80 0 01-10.88 159.2h-64v32h64c61.86-.18 111.85-50.48 111.66-112.34a112 112 0 00-85.41-108.46z" />\n                <path d="M245.03 253.66l-64 64 22.56 22.56 36.8-36.64v153.44h32V303.58l36.64 36.64 22.56-22.56-64-64a16 16 0 00-22.55 0z" />\n            </svg>\n            Upload Music\n        '})}function rmMusic(){let e=event.currentTarget.dataset.uid,t=event.currentTarget.closest("tr");e&&swal({title:`${i18next.t("Are you sure")}`,text:`${i18next.t("You wont be able to revert this")}`,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",background:"rgba(47, 47, 47, .75)",cancelButtonColor:"#d33",confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`}).then(n=>{n.value&&(fetch("/music/remove",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({music:e})}),t.remove())})}function playOneMusic(){let e=event.currentTarget.dataset.uid;fetch("/music/list",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})}).then(e=>e.json()).then(e=>{200===e.status?(playList=e.playList,controls=new PlayerControls,buildPlaylist(),controls.updateSong(),controls.adjustVolume(),controls.playPause()):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})}function getMovies(){fetch(`https://api.themoviedb.org/3/discover/movie?api_key=249f222afb1002186f4d88b2b5418b55&language=${$STATE.user.language}&sort_by=popularity.desc&include_video=true`,{method:"GET",headers:{Accept:"application/json, text/plain, */*"}}).then(e=>e.json()).then(e=>{if(e.results.length){let t="";for(let n=0;n<e.results.length;n++)t+=`\n                        <div class="MovieCard" data-zoom data-title="${e.results[n].title}" data-adult="${e.results[n].adult}" data-original_language="${e.results[n].original_language}" data-vote_average="${e.results[n].vote_average}" data-release_date="${e.results[n].release_date}" data-overview="${e.results[n].overview}" onclick="showMovieInfo()">\n                            <img src="https://image.tmdb.org/t/p/w500/${e.results[n].poster_path}" class="lozad" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" data-loaded="true">\n                        </div>\n                    `;document.getElementById("trantube-movie").insertAdjacentHTML("beforeend",` <div class="videos">${t}</div> `)}})}function getPodcasts(){let e=$STATE.user.language||navigator.language||"us";fetch("/podcasts",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({region:e})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("lobby-result").innerHTML=e.template)})}function updatePodcast(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let e=event.currentTarget.dataset.uid;!$STATE.podcast.isFetching&&e&&($STATE.podcast.isFetching=!0,fetch("/podcast",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})}).then(e=>e.json()).then(e=>{200===e.status&&(playList=e.episodes.map(t=>({title:`${t.title}`,artist:`${e.publisher}`,avatar:`${t.image}`,url:`${t.audio}`,duration:t.audio_length_sec})),controls=new PlayerControls,buildPlaylist(),controls.updateSong(),controls.adjustVolume(),controls.playPause(),$STATE.podcast.isFetching=!1)}))}}function showMovieInfo(){let e=event.currentTarget.dataset;Swal({title:`${e.title}`,html:`\n            <aside id="InfoCard">\n                <div id="InfoCardContent">\n                    <ul>\n                        <li>${e.overview}</li>\n                        <li>${e.release_date}</li>\n                    </ul>\n                </div>\n            </aside>\n        `,width:600,animation:!0,showConfirmButton:!1,background:"rgba(30, 30, 30, .8)"})}function changeUserNickname(){let e=event.currentTarget.value;13===(event.which||event.keyCode)&&e&&(event.preventDefault(),fetch("/changeNickname",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({nickname:e})}),toast({type:"success",title:`${i18next.t("Update successfully")}`}))}function changeUserSlogan(){let e=event.currentTarget.value;13===(event.which||event.keyCode)&&e&&(event.preventDefault(),fetch("/changeSlogan",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({slogan:e})}),toast({type:"success",title:`${i18next.t("Update successfully")}`}))}function changePrivacy(){let e=event.currentTarget.dataset.process,t=!event.currentTarget.classList.contains("on");switch(fetch("/changePrivacy",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({process:e,status:t})}),t?event.currentTarget.classList.add("on"):event.currentTarget.classList.remove("on"),e){case"hideCursorWhenIdle":$STATE.user.property.hideCursorWhenIdle=t;break;case"nonFriendGroupInvite":case"onlyFriendsOfFriendsCanSendFriendRequest":break;case"autoplaySliderVideo":$STATE.user.property.autoplaySliderVideo=t;break;case"showSliderThumbnails":$STATE.user.property.showSliderThumbnails=t,setfsLightboxProps();break;case"isSearchable":$STATE.user.property.isSearchable=t}}function changeSliderDisplayDuration(){let e=Number(event.currentTarget.value);e&&(fetch("/changeSliderDisplayDuration",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({duration:e})}),$STATE.user.property.sliderDisplayDuration=e,setfsLightboxProps())}function eduFormToggle(){let e="";for(let t=(new Date).getFullYear()+4;t>1894;t--)e+=`<option value="${t}">${t}</option>`;Swal({title:`${i18next.t("Studied at")}`,html:`\n            <aside id="educationForm">\n                <div class="icon-input">\n                    <span><i class="fas fa-university"></i></span>\n                    <input type="text" placeholder="University" name="university" id="university" list="universityList" required />\n                    <datalist id="universityList"></datalist>\n                </div>\n                <div class="select-wrapper">\n                    <select name="level" required>\n                        <option value="">-  ${i18next.t("Education")}  -</option>\n                        <option value="doctoral_degree">${i18next.t("Doctoral degree")}</option>\n                        <option value="master_degree">${i18next.t("Master degree")}</option>\n                        <option value="bachelor_degree">${i18next.t("Bachelor degree")}</option>\n                        <option value="junior_college">${i18next.t("Junior college")}</option>\n                        <option value="senior_high_school">${i18next.t("Senior high school")}</option>\n                        <option value="vocational_high_school">${i18next.t("Vocational high school")}</option>\n                        <option value="junior_high_school">${i18next.t("Junior high school")}</option>\n                        <option value="elementary_school">${i18next.t("Elementary school")}</option>\n                        <option value="preschool">${i18next.t("Preschool")}</option>\n                    </select>\n                </div>\n                <div class="icon-input">\n                    <span><i class="fas fa-bullseye"></i></span>\n                    <input type="text" placeholder="Major" name="major" required />\n                </div>\n                <div class="select-wrapper">\n                    <select name="start" required>\n                        <option class="item" value="">- Start -</option>\n                        ${e}\n                    </select>\n                </div>\n                <div class="select-wrapper">\n                    <select name="end" required>\n                        <option class="item" value="">- End -</option>\n                        <option value="now">Still in here</option>\n                        ${e}\n                    </select>\n                </div>\n            </aside>\n        `,preConfirm:()=>new Promise((e,t)=>{let n=document.querySelector('#educationForm input[name="university"]').value,o=document.querySelector('#educationForm select[name="level"]').value,a=document.querySelector('#educationForm input[name="major"]').value,r=document.querySelector('#educationForm select[name="start"]').value,i=document.querySelector('#educationForm select[name="end"]').value;if(n&&o&&a&&r&&i){let t={university:n,level:o,major:a,start:r,end:i};document.querySelector("#userEduInfo li").insertAdjacentHTML("beforeend",`\n                        <span>\n                            ${n}\n                            <div class="edit">\n                                <button type="button" name="button" data-uid="WN1IO-6jB" data-category="edu" onclick="rmUserInfo()"><i class="fas fa-trash"></i></button>\n                            </div>\n                        </span>\n                    `),fetch("/addUserInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({university:n,level:o,major:a,start:r,end:i,category:"edu"})}),e(t)}else t()}),width:600,animation:!0,confirmButtonText:"Select",background:"rgba(30, 30, 30, .8)"}).then(e=>{if(e.value){let{university:t,level:n,major:o,start:a,end:r,category:i}=e}})}function addUserInfo(e){let t=e.dataset.category;switch(t){case"otherPlaces":let e=document.querySelector('#T-OtherPlacesForm select[name="country"]').value,n=document.querySelector('#T-OtherPlacesForm input[name="city"]').value;e&&n?(fetch("/addUserInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({country:e,city:n,category:t})}),document.getElementById("contactForm").classList.remove("active")):toast({type:"error",title:`${i18next.t("Please fill in required fields")}`})}}function rmUserInfo(){let{uid:e,category:t}=event.currentTarget.dataset;e&&t&&("contact"===t?event.currentTarget.closest("li").remove():event.currentTarget.closest("span").remove(),fetch("/rmUserInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({category:t,uid:e})}))}function workFormToggle(){let e="";for(let t=(new Date).getFullYear();t>1894;t--)e+=`<option value="${t}">${t}</option>`;Swal({title:`${i18next.t("Job")}`,html:`\n            <aside id="workForm">\n                <div class="icon-input">\n                    <span><i class="fas fa-building"></i></span>\n                    <input type="text" placeholder="Company" name="company" required/>\n                </div>\n                <div class="icon-input">\n                    <span><i class="fas fa-bullseye"></i></span>\n                    <input type="text" placeholder="Position" name="position" required/>\n                </div>\n                <div class="select-wrapper">\n                    <select name="start" required>\n                        <option class="item" value="">- Start -</option>\n                        ${e}\n                    </select>\n                </div>\n                <div class="select-wrapper">\n                    <select name="end" required>\n                        <option class="item" value="">- End -</option>\n                        <option value="now">Still in here</option>\n                        ${e}\n                    </select>\n                </div>\n            </aside>\n        `,preConfirm:()=>new Promise((e,t)=>{let n=document.querySelector('#workForm input[name="company"]').value,o=document.querySelector('#workForm input[name="position"]').value,a=document.querySelector('#workForm select[name="start"]').value,r=document.querySelector('#workForm select[name="end"]').value;if(n&&o&&a&&r){e({company:n,position:o,start:a,end:r})}else e(data)}),width:600,animation:!0,confirmButtonText:"Select",background:"rgba(30, 30, 30, .8)"}).then(e=>{if(e.value){let{company:t,position:n,start:o,end:a}=e.value;document.querySelector("#userWorkInfo li").insertAdjacentHTML("beforeend",`\n                <span>\n                    ${t}\n                    <div class="edit">\n                        <button type="button" name="button" data-uid="WN1IO-6jB" data-category="work" onclick="rmUserInfo()"><i class="fas fa-trash"></i></button>\n                    </div>\n                </span>\n            `),fetch("/addUserInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({company:t,position:n,start:o,end:a,category:"work"})})}})}function contactFormToggle(){fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.5.2/dom/contact-form.txt").then(e=>e.text()).then(e=>{Swal({title:`${i18next.t("Contact")}`,html:e,preConfirm:()=>new Promise((e,t)=>{let n=document.querySelector('#contactForm select[name="platform"]').value,o=document.querySelector('#contactForm input[name="link"]').value,a={platform:n,link:o,category:"contact"};n&&o?(document.querySelector("#userContactInfo li").insertAdjacentHTML("beforebegin",`\n                                <li class="${n}">\n                                    <span class="tooltip-top">\n                                        <button type="button" name="button" class="delete" data-category="contact" onclick="rmUserInfo()"><i class="fas fa-user-minus"></i></button>\n                                    </span>\n                                    <a href="${o}" target="_blank"><i class="fab fa-${n}"></i></a>\n                                </li>\n                            `),fetch("/addUserInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify(a)}),e(a)):e()}),width:600,animation:!0,confirmButtonText:"Select",background:"rgba(30, 30, 30, .8)"}).then(e=>{e.value})})}async function currentCityFormToggle(){const{value:e}=await Swal.fire({title:"Country",input:"text",inputPlaceholder:"Enter your country name",background:"rgba(30, 30, 30, .8)"});Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@6.2.9/json/country.json").then(e=>e.json()).then(t=>{Swal.close();let n=t.filter(t=>t.code.toLowerCase().indexOf(e.toLowerCase())>-1||t.name.toLowerCase().indexOf(e.toLowerCase())>-1),o="";for(let e=0;e<n.length;e++)o+=`\n                    <li>\n                        <input type="radio" name="country" value="${n[e].code}" id="${n[e].code}">\n                        <label for="${n[e].code}">\n                            <img src="https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@4.3.1/country_circle_icon/${n[e].name.split(" ").join("-").toLowerCase()}.webp" class="lozad" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" data-loaded="true">\n                        </label>\n                    </li>\n                `;Swal.mixin({confirmButtonText:"Next &rarr;",showCancelButton:!0,progressSteps:["1","2"],background:"rgba(30, 30, 30, .8)"}).queue([{title:"Flag",html:`<ul class="image-radio">${o}</ul>`,preConfirm:()=>new Promise((e,t)=>{let n=document.querySelector('input[name="country"]:checked').value;n?e(n):t()}),width:930,animation:!0,confirmButtonText:"Select"},{title:"City",input:"text"}]).then(e=>{if(e.value){let n=e.value[0],o=e.value[1];n&&o&&(document.querySelector("#userCurrentLiveInfo li").insertAdjacentHTML("beforeend",`\n                            <span>\n                                <img src="https://cdn.jsdelivr.net/gh/TranquilityTech/cdn@4.3.1/country_circle_icon/${t.find(e=>e.code===n).name.split(" ").join("-").toLowerCase()}.webp" alt="">\n                                ${o}\n                                <div class="edit">\n                                    <button type="button" name="button" data-category="work" onclick="rmUserInfo()"><i class="fas fa-trash"></i></button>\n                                </div>\n                            </span>\n                        `),fetch("/addUserInfo",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({country:n,city:o,category:"currentPlaces"})}))}})})}function updateBirthday(){let e=event.currentTarget.value;e&&(fetch("/changeBirthday",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({birthday:e})}),toast({type:"success",title:`${i18next.t("Update successfully")}`}))}function updateLanguage(){let e=event.currentTarget.value;e&&(toast({type:"success",title:`${i18next.t("Update successfully")}`}),fetch("/changeLanguage",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({language:e})}))}function sendVideoComment(){let e=event.which||event.keyCode;if(13===e&&event.shiftKey&&(event.preventDefault(),document.execCommand("insertHTML",!1,"<br> </br>")),13==e&&!event.shiftKey){event.preventDefault();let e=event.currentTarget.dataset.video,t=event.currentTarget.closest(".pre_comment").querySelector(".message").innerHTML,n=DOMPurify.sanitize(`${t}`,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["style"]});e&&t&&(loadingBtn(),document.querySelector(".pre_comment").remove(),fetch("/video/comment",{method:"POST",body:JSON.stringify({uid:e,content:n}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status&&document.querySelector(".comments").insertAdjacentHTML("afterbegin",e.template)}))}}function createVideoCommentForm(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let e=document.querySelector(".pre_comment"),t=event.currentTarget.dataset.video;!e&&t&&(document.querySelector(".comments").insertAdjacentHTML("afterbegin",`\n                <div class="pre_comment">\n                    <div class="avatar">\n                        <img src="/images/UserAlbum/${$STATE.userDefaultAlbums.avatar}/${$STATE.user.avatar}" loading="lazy" alt="Image not found" onerror="imageNotFound(this)" />\n                    </div>\n                    <div class="msg">\n                        <div class="tri"></div>\n                        <div class="msg_inner">\n                            <div class="username">\n                                <a href="/user?uid=${$STATE.user.uid}">${$STATE.user.name}</a>\n                            </div>\n                            <aside class="message-input-wrapper">\n                                <div class="emoji-picker-menu hidden"></div>\n                                <div class="message content" contentEditable="true"data-video="${t}" onkeypress="sendVideoComment()"></div>\n                                <button type="button" name="button" class="emoji-picker-btn" onclick="emojiPickerMenuToggle()"><i class="fas fa-meh-blank"></i></button>\n                            </aside>\n                        </div>\n                    </div>\n                </div>\n            `),document.querySelector(".comments .pre_comment .content").focus())}}function sendVideoLike(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let{uid:e,status:t}=event.currentTarget.dataset;if(event.currentTarget.classList.contains("checked"));else if(event.currentTarget.closest(".like-container").querySelector(".checked")){let e=event.currentTarget.closest(".like-container").querySelector(".checked").querySelector(".num").textContent,t=parseInt(event.currentTarget.querySelector(".num").textContent,10);event.currentTarget.closest(".like-container").querySelector(".checked").querySelector(".num").textContent=e-1,event.currentTarget.querySelector(".num").textContent=t+1,event.currentTarget.closest(".like-container").querySelector(".checked").classList.remove("checked"),event.currentTarget.classList.add("checked")}else{let e=parseInt(event.currentTarget.querySelector(".num").textContent,10);event.currentTarget.querySelector(".num").textContent=e+1,event.currentTarget.classList.add("checked")}fetch("/video/like",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,status:t})})}}function changePlayTrantube(){event.preventDefault();let e=event.currentTarget.dataset.uid;document.querySelector(".VideoCard");e&&(videojs("video").src({type:"video/mp4",src:`/v?category=Trantube&uid=${e}`}),videojs("video").play(),window.scrollTo({top:0,behavior:"smooth"}),document.getElementById("video-info").innerHTML="",fetch("/video/info",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})}).then(e=>e.json()).then(t=>{200===t.status?(document.getElementById("video-info").innerHTML=t.template,window.history.pushState("",window.title,`/watch?uid=${e}`)):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}function editAlbumInputTrigger(){document.getElementById("editAlbumInput").click()}async function posterAlbumInputChange(e){const t=event.currentTarget,n=t.dataset.category,o=t.dataset.album;for(let a=0;a<t.files.length;a++){const r=t.files[a],i=URL.createObjectURL(r),s=uuid();r.preloadImgUid=s,r.type.match("image")?e.closest(".message-input-wrapper").querySelector("ul.image-list").insertAdjacentHTML("beforeend",`\n                <li>\n                    <img src="${i}" class="loading" id="posterImg-${s}" alt="Image not found" onerror="imageNotFound(this)" />\n                    <svg id="progress-${s}" version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                        <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                        <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                    </svg>\n                </li>\n            `):e.closest(".message-input-wrapper").querySelector("ul.image-list").insertAdjacentHTML("beforeend",`\n                <li>\n                    <video src="${i}" class="lozad loading" id="posterImg-${s}" controlsList="nodownload" loop muted></video>\n                    <svg id="progress-${s}" version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                        <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                        <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                    </svg>\n                </li>\n            `);let c=new FormData;c.append("file",r),c.append("preImgUuid",r.preloadImgUid),axios({method:"post",url:`/upload/album/source?uid=${o}&category=${n}`,data:c,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let t=document.querySelector(`#progress-${r.preloadImgUid} .circle`).getTotalLength();!function(e){let n=t/100*(e=100-e);document.querySelector(`#progress-${r.preloadImgUid} .circle`).style["stroke-dashoffset"]=n}(Math.floor(e.loaded/e.total*100))}}}).then(t=>{switch(document.querySelector(`#posterImg-${r.preloadImgUid}`).classList.remove("loading"),document.querySelector(`#progress-${r.preloadImgUid}`).remove(),t.data.type){case"video":e.closest(".status-card").insertAdjacentHTML("afterbegin",`<div data-uid="${t.data.uid}" data-video="${t.data.video}" data-thumbnail="${t.data.convertedImg}"></div>`);break;case"image":e.closest(".status-card").insertAdjacentHTML("afterbegin",`<div data-uid="${t.data.uid}" data-img="${t.data.convertedImg}"></div>`)}})}}async function editAlbumInputChange(){const{category:e,album:t}=event.currentTarget.dataset;for(let n=0;n<event.currentTarget.files.length;n++){const o=event.currentTarget.files[n],a=URL.createObjectURL(o),r=uuid();o.preloadImgUid=r,document.querySelector("#album-editor .row div:nth-child(1)").insertAdjacentHTML("afterend",`\n            <div class="3u 6u(large) 12u(small) lozad">\n                <a href="${a}" data-fslightbox="roadtrip">\n                    <div class="album-container">\n                        <img src="${a}" class="loading" id="posterImg-${r}" alt="Image not found" onerror="imageNotFound(this)" />\n                        <svg id="progress-${r}" version="1.1" width="100px" height="100px" viewBox="-10 -10 120 120">\n                            <path class="circle-bg" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                            <path class="circle" d="M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50" />\n                        </svg>\n                    </div>\n                </a>\n            </div>\n        `);let i=new FormData;i.append("file",o),i.append("preImgUuid",o.preloadImgUid),axios({method:"post",url:`/upload/album/source?uid=${t}&category=${e}`,data:i,headers:{"Content-Type":"multipart/form-data","CSRF-Token":$STATE.csrfToken},credentials:"include",onUploadProgress:e=>{if(e.total){let t=document.querySelector(`#progress-${o.preloadImgUid} .circle`).getTotalLength();!function(e){let n=t/100*(e=100-e);document.querySelector(`#progress-${o.preloadImgUid} .circle`).style["stroke-dashoffset"]=n}(Math.floor(e.loaded/e.total*100))}}}).then(e=>{document.querySelector(`#posterImg-${o.preloadImgUid}`).classList.remove("loading"),document.querySelector(`#progress-${o.preloadImgUid}`).remove(),refreshFsLightbox(),setfsLightboxProps()})}}function copyToClipboard(e){let t=document.createElement("input");document.body.appendChild(t),t.setAttribute("value",e),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function copyText(){copyToClipboard(event.currentTarget.dataset.text),toast({type:"success",title:`${i18next.t("Copy To Clipboard")}`})}socket.on("receive-msg",e=>{if(document.querySelector(`#msg-friend-list li[data-messenger='${e.messenger}']`)){let t=document.querySelector("#messenger-wrapper").classList.contains("active");(document.querySelector(`#msg-friend-list li[data-messenger='${e.messenger}']`)&&!t||!document.querySelector(`#msg-friend-list li[data-messenger='${e.messenger}']`).classList.contains("selected")&&t)&&document.querySelector(`#msg-friend-list li[data-messenger='${e.messenger}'] .msg-avatar`).classList.add("alert");let n=document.querySelector(`#msg-${e.messenger} .content-container ul.chat-thread`),o=!1,a=n.lastElementChild;a&&(o=a.dataset.user===e.user);o||e.avatar;let r=e.user===$STATE.user.uid?"message-personal":"message-other";n.insertAdjacentHTML("beforeend",`\n            <li class="${r}" data-user="${e.user}">\n                ${DOMPurify.sanitize(e.content,{SANITIZE_DOM:!0,ALLOWED_TAGS:["div","span","img","br","a"],ADD_ATTR:["target"],FORBID_ATTR:["style"]})}\n            </li>\n        `),notificationSound(),scrollToDown(document.querySelector(`#msg-${e.messenger} .content-container`))}else fetchMessager(e)}),socket.on("receive-file",e=>{if(document.querySelector(`#msg-friend-list li[data-messenger='${e.messenger}']`)){e.user!==$STATE.user.uid&&document.querySelector(`#msg-friend-list [data-messenger='${e.messenger}'] .msg-avatar`).classList.add("alert");let t=document.querySelector(`#msg-${e.messenger} .content-container ul.chat-thread`),n="";e.files.forEach(e=>{n+=`\n                <div class="upload">\n                    <div class="icon">\n                        <i class="fas fa-file"></i>\n                    </div>\n                    <div class="text">\n                        <div class="header">${e.file}</div>\n                        <span>${getReadableFileSizeString(e.size)}</span>\n                    </div>\n                </div>\n            `}),t.insertAdjacentHTML("beforeend",`<li class="file-other">${n}</li>`),scrollToDown(document.querySelector(`#msg-${e.messenger} .content-container`))}else fetchMessager(e);notificationSound()}),socket.on("receive-media",e=>{if(document.querySelector(`#msg-friend-list li[data-messenger='${e.messenger}']`)){e.user!==$STATE.user.uid&&document.querySelector(`#msg-friend-list [data-messenger='${e.messenger}'] .msg-avatar`).classList.add("alert");let t=document.querySelector(`#msg-${e.messenger} .content-container ul.chat-thread`),n="";e.files.forEach(t=>{"image"===t.type?n+=`\n                    <li>\n                        <a href="/images/MsgAlbum/${e.messenger}/${t.image}" data-fslightbox="${e.uid}">\n                            <picture>\n                                <source media="(max-width: 480px)" srcset="/images/MsgAlbum/${e.messenger}/${t.image}?width=600, /images/MsgAlbum/${e.messenger}/${t.image}?width=1000 2x" type="image/webp" />\n                                <source media="(max-width: 736px)" srcset="/images/MsgAlbum/${e.messenger}/${t.image}?width=800, /images/MsgAlbum/${e.messenger}/${t.image}?width=1500 2x" type="image/webp" />\n                                <source media="(max-width: 980px)" srcset="/images/MsgAlbum/${e.messenger}/${t.image}?width=1000, /images/MsgAlbum/${e.messenger}/${t.image}?width=2000 2x" type="image/webp" />\n                                <source media="(max-width: 1280px)" srcset="/images/MsgAlbum/${e.messenger}/${t.image}?width=1500, /images/MsgAlbum/${e.messenger}/${t.image}?width=2000 2x" type="image/webp" />\n                                <source media="(max-width: 1680px)" srcset="/images/MsgAlbum/${e.messenger}/${t.image}?width=1800, /images/MsgAlbum/${e.messenger}/${t.image}?width=2000 2x" type="image/webp" />\n                                <img src="/images/MsgAlbum/${e.messenger}/${t.image}" class="lozad" loading="lazy" alt="Image not found" onerror="imageNotFound(this)"  />\n                            </picture>\n                        </a>\n                    </li>\n                `:n+=`\n                    <li>\n                        <div class="video-tag"><span class="video-icon"></span></div>\n                        <a href="/images/MsgAlbum/${e.messenger}/${t.video}" data-fslightbox="${e.uid}">\n                            <video src="/images/MsgAlbum/${e.messenger}/${t.video}" class="lozad" controlsList="nodownload" loop poster="/images/MsgAlbum/${e.messenger}/${t.thumbnail}" muted></video>\n                        </a>\n                    </li>\n                `}),t.insertAdjacentHTML("beforeend",`\n            <li class="file-other">\n                <ul class="media">${n}</ul>\n            </li>\n        `),scrollToDown(document.querySelector(`#msg-${e.messenger} .content-container`)),refreshFsLightbox(),setfsLightboxProps()}else fetchMessager(e);notificationSound()}),socket.on("updateTypingStatus",e=>{let t=document.querySelector(`#msg-${e.messenger}`);t&&(t.dataset.isloading=e.status)}),socket.on("notification_add",()=>{let e=document.querySelector("#msg-friend-list .menuIcon").dataset.count||0;document.querySelector("#msg-friend-list .menuIcon").dataset.count=Number(e)+1,PageTitleNotification.on("New Notification !")}),socket.on("friend-online",e=>{let t=document.querySelector(`.ContactCard[data-user="${e.user}"]`);t&&t.classList.add("online"),onlineToast({title:`${e.nickname||e.name} online`,imageUrl:`/img/UserAlbum/${e.avatar.album}/${e.avatar.image}?width=50`,imageWidth:50,imageHeight:50,imageAlt:"avatar"})}),socket.on("friend-offline",e=>{let t=document.querySelector(`.ContactCard[data-user="${e.user}"]`);t&&t.classList.remove("online"),onlineToast({title:`${e.nickname||e.name} offline`,imageUrl:`/img/UserAlbum/${e.avatar.album}/${e.avatar.image}?width=50`,imageWidth:50,imageHeight:50,imageAlt:"avatar"})}),socket.on("newMeet",e=>{!document.querySelector(`#msg-friend-list [data-messenger='${e.messenger}']`)||document.querySelector("#messenger-wrapper").classList.contains("active")||document.querySelector(`#msg-friend-list li[data-messenger='${e.messenger}']`).classList.contains("selected")||document.querySelector(`#msg-friend-list [data-messenger='${e.messenger}'] .msg-avatar`).classList.add("alert"),document.querySelector(`#msg-friend-list [data-messenger='${e.messenger}']`)&&(document.querySelector(`#msg-${e.messenger} .top-bar`).classList.remove("hidden"),document.querySelector(`#msg-${e.messenger} .top-bar button`).dataset.room=e.room,notificationSound())}),socket.on("friends",e=>{}),window.onbeforeunload=function(){socket.emit("disconnect")},document.addEventListener("click",()=>{!document.querySelector("#messenger-wrapper")||event.target.closest("#messenger-wrapper")||event.target.closest(".fslightbox-container ")||(document.querySelector("#messenger-wrapper").classList.remove("active"),document.querySelector("#messenger-cover").classList.remove("active"))},!1);const publicVapidKey="BKhn1c1rb9L-h9Ztiq-Fp8ndg0WguDIWDtIYsJ9rIqClVXgvT5h0ipA29f6dTjuTkzENKqDKSgYfN9_bX-fX_2o";function urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),o=new Uint8Array(n.length);for(let e=0;e<n.length;++e)o[e]=n.charCodeAt(e);return o}async function webNotificationSend(){const e=await navigator.serviceWorker.register("/js/worker.js"),t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlBase64ToUint8Array(publicVapidKey)});await fetch("/webNotificationSubscribe",{method:"POST",body:JSON.stringify({key:t}),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},withCredentials:!0})}function report(){let{category:e,source:t}=event.currentTarget.dataset;e&&t&&Swal.fire({input:"textarea",title:"Report",inputPlaceholder:"Type your message here...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,background:"rgba(47, 47, 47, .75)",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:`${i18next.t("Send")}`,cancelButtonText:`${i18next.t("Cancel")}`}).then(n=>{n.value&&fetch("/report",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},body:JSON.stringify({category:e,source:t,content:n.value}),withCredentials:!0})})}function previewTrantubeUpload(){let e=document.querySelector("#video-canvas"),t=e.getContext("2d"),n=document.querySelector("#main-video");document.querySelector("#upload-button").addEventListener("click",()=>{document.querySelector("#uploadVideoInput").click()}),document.querySelector("#uploadVideoInput").addEventListener("change",()=>{-1!=["video/mp4"].indexOf(document.querySelector("#uploadVideoInput").files[0].type)?(document.querySelector("#main-video source").setAttribute("src",URL.createObjectURL(document.querySelector("#uploadVideoInput").files[0])),n.addEventListener("loadedmetadata",()=>{let t=n.duration,o="";for(let e=0;e<Math.floor(t);e+=4)o+=`<option value="${e}">${e} s</option>`;document.querySelector("#set-video-seconds").innerHTML=o,document.querySelector("#thumbnail-container").style.display="block",n.currentTime=0,e.width=n.videoWidth,e.height=n.videoHeight}),n.load(),n.style.display="none"):Swal.fire({type:"error",title:"Only MP4 format allowed",confirmButtonText:"Oops",background:"rgba(47, 47, 47, .75)"})}),document.querySelector("#set-video-seconds").addEventListener("change",()=>{document.querySelector("#set-video-seconds").disabled=!0,n.currentTime=document.querySelector("#set-video-seconds").value}),document.querySelector("#main-video").addEventListener("timeupdate",()=>{document.querySelector("#set-video-seconds").disabled=!1,t.drawImage(n,0,0,n.videoWidth,n.videoHeight),document.querySelector("#thumbnail-img").src=e.toDataURL()})}function toggleThemeList(){event.currentTarget.classList.toggle("active"),document.querySelector("#nav-setting-toolbox .color-option").classList.toggle("hidden")}function changeTheme(){let e=event.currentTarget.dataset.color;event.currentTarget.querySelector('input[name="theme"]').checked&&e&&(document.querySelector("body").dataset.theme=e,$STATE.isGuest||fetch("/changeTheme",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},body:JSON.stringify({color:e}),withCredentials:!0}))}function channelSubscribe(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let e=event.currentTarget.dataset.channel;if(!e)return;let t=event.currentTarget.classList.contains("subscribed")?0:1;event.currentTarget.classList.toggle("subscribed"),t?(event.currentTarget.querySelector("span").textContent=`${i18next.t("Subscribed")}`,event.currentTarget.querySelector("i").classList.add("heartBeatAnimation"),toast({type:"success",title:`${i18next.t("Subscribed")}`})):(event.currentTarget.querySelector("span").textContent=`${i18next.t("Subscribe")}`,event.currentTarget.querySelector("i").classList.remove("heartBeatAnimation"),toast({type:"success",title:`${i18next.t("Unsubscribed")}`})),fetch("/channel/subscribe",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({channel:e,status:t})})}}function updateAlbumInfo(){let{album:e,category:t}=event.currentTarget.dataset,n=document.getElementById("albumTitle").value,o=document.getElementById("albumDesc").value,a=[...document.querySelectorAll(".setting-form .album-container img")].map(e=>e.dataset.uid);e&&t&&(fetch("/album/update",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e,title:n,desc:o,hash_tags:[],sources_sort:a,category:t})}),toast({type:"success",title:`${i18next.t("Update successful")}`}))}function rmAlbum(){let{category:e,album:t}=event.currentTarget.dataset;"true"!==event.currentTarget.dataset.isdefaultalbum?swal({title:`${i18next.t("Are you sure")}`,text:`${i18next.t("You wont be able to revert this")}`,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",background:"rgba(47, 47, 47, .75)",cancelButtonColor:"#d33",confirmButtonText:`${i18next.t("Confirm")}`,cancelButtonText:`${i18next.t("Cancel")}`}).then(n=>{n.value?(Swal.fire({background:"rgba(30, 30, 30, .8)",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}}),fetch("/album/remove",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:t,category:e})}).then(e=>e.json()).then(e=>{Swal.close(),200===e.status?window.location.reload(!1):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})):"cancel"===n.dismiss&&swal({title:`${i18next.t("Cancelled")}`,text:`${i18next.t("Your album is safe")}`,background:"rgba(47, 47, 47, .75)",type:"error"})}):toast({type:"error",title:`${i18next.t("The default album cannot be deleted")}`})}function scrollToDown(e){e.scrollTop=e.scrollHeight}function tqfetch(){switch(document.querySelectorAll("[data-url]").forEach((e,t)=>e.classList.remove("selected")),event.currentTarget.classList.add("selected"),event.currentTarget.dataset.url){case"public":getPublic();break;case"calendar":getCalendar();break;case"me":getMe();break;case"watch":getTube();break;case"news":getNews();break;case"setting":getSetting()}}function showAppLoading(){window.scrollTo(0,0),document.getElementById("app").innerHTML='<aside id="app-loading"> <svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <defs> <symbol id="icon-world" viewBox="0 0 216 100"> <title>world</title> <g fill-rule="nonzero"> <path d="M48 94l-3-4-2-14c0-3-1-5-3-8-4-5-6-9-4-11l1-4 1-3c2-1 9 0 11 1l3 2 2 3 1 2 8 2c1 1 2 2 0 7-1 5-2 7-4 7l-2 3-2 4-2 3-2 1c-2 2-2 9 0 10v1l-3-2zM188 90l3-2h1l-4 2zM176 87h2l-1 1-1-1zM195 86l3-2-2 2h-1zM175 83l-1-2-2-1-6 1c-5 1-5 1-5-2l1-4 2-2 4-3c5-4 9-5 9-3 0 3 3 3 4 1s1-2 1 0l3 4c2 4 1 6-2 10-4 3-7 4-8 1zM100 80c-2-4-4-11-3-14l-1-6c-1-1-2-3-1-4 0-2-4-3-9-3-4 0-5 0-7-3-1-2-2-4-1-7l3-6 3-3c1-2 10-4 11-2l6 3 5-1c3 1 4 0 5-1s-1-2-2-2l-4-1c0-1 3-3 6-2 3 0 3 0 2-2-2-2-6-2-7 0l-2 2-1 2-3-2-3-3c-1 0-1 1 1 2l1 2-2-1c-4-3-6-2-8 1-2 2-4 3-5 1-1-1 0-4 2-4l2-2 1-2 3-2 3-2 2 1c3 0 7-3 5-4l-1-3h-1l-1 3-2 2h-1l-2-1c-2-1-2-1 1-4 5-4 6-4 11-3 4 1 4 1 2 2v1l3-1 6-1c5 0 6-1 5-2l2 1c1 2 2 2 2 1-2-4 12-7 14-4l11 1 29 3 1 2-3 3c-2 0-2 0-1 1l1 3h-2c-1-1-2-3-1-4h-4l-6 2c-1 1-1 1 2 2 3 2 4 6 1 8v3c1 3 0 3-3 0s-4-1-2 3c3 4 3 7-2 8-5 2-4 1-2 5 2 3 0 5-3 4l-2-1-2-2-1-1-1-1-2-2c-1-2-1-2-4 0-2 1-3 4-3 5-1 3-1 3-3 1l-2-4c0-2-1-3-2-3l-1-1-4-2-6-1-4-2c-1 1 3 4 5 4h2c1 1 0 2-1 4-3 2-7 4-8 3l-7-10 5 10c2 2 3 3 5 2 3 0 2 1-2 7-4 4-4 5-4 8 1 3 1 4-1 6l-2 3c0 2-6 9-8 9l-3-2zm22-51l-2-3-1-1v-1c-2 0-2 2-1 4 2 3 4 4 4 1z"/> <path d="M117 75c-1-2 0-6 2-7h2l-2 5c0 2-1 3-2 1zM186 64h-3c-2 0-6-3-5-5 1-1 6 1 7 3l2 3-2-1zM160 62h2c1 1 0 1-1 1l-1-1zM154 57l-1-2c2 2 3 1 2-2l-2-3 2 2 1 4 1 3v2l-3-4zM161 59c-1-1-1-2 1-4 3-3 4-3 4 0 0 4-2 6-5 4zM167 59l1-1 1 1-1 1-1-1zM176 59l1-1v2l-1-1zM141 52l1-1v2l-1-1zM170 52l1-1v2l-1-1zM32 50c-1-2-4-3-6-4-4-1-5-3-7-6l-3-5-2-2c-1-3-1-6 2-9 1-1 2-3 1-5 0-4-3-5-8-4H4l2-2 1-1 1-1 2-1c1-2 7-2 23-1 12 1 12 1 12-1h1c1 1 2 2 3 1l1 1-3 1c-2 0-8 4-8 5l2 1 2 3 4-3c3-4 4-4 5-3l3 1 1 2 1 2c3 0-1 2-4 2-2 0-2 0-2 2 1 1 0 2-2 2-4 1-12 9-12 12 0 2 0 2-1 1 0-2-2-3-6-2-3 0-4 1-4 3-2 4 0 6 3 4 3-1 3-1 2 1s-1 2 1 2l1 2 1 3 1 1-3-2zm8-24l1-1c0-1-4-3-5-2l1 1v2c-1 1-1 1 0 0h3zM167 47v-3l1 2c1 2 0 3-1 1z"/> <path d="M41 43h2l-1 1-1-1zM37 42v-1l2 1h-2zM16 38l1-1v2l-1-1zM172 32l2-3h1c1 2 0 4-3 4v-1zM173 26h2l-1 1-1-1zM56 22h2l-2 1v-1zM87 19l1-2 1 3-1 1-1-2zM85 19l1-1v1l-1 1v-1zM64 12l1-3c2 0-1-4-3-4s-2 0 0-1V3l-6 2c-3 1-3 1-2-1 2-1 4-2 15-2h14c0 2-6 7-10 9l-5 2-2 1-2-2zM53 12l1-1c2 0-1-3-3-3-2-1-1-1 1-1l4 2c2 1 2 1 1 3-2 1-4 2-4 0zM80 12l1-1 1 1-1 1-1-1zM36 8h-2V7c1-1 7 0 7 1h-5zM116 7l1-1v1l-1 1V7zM50 5h2l-1 1-1-1zM97 5l2-1c0-1 1-1 0 0l-2 1z"/> </g> </symbol> <symbol id="icon-repeated-world" viewBox="0 0 432 100"> <use href="#icon-world" x="0"></use> <use href="#icon-world" x="189"></use> </symbol> </defs> </svg> <span class="world"> <svg> <use href="#icon-repeated-world"></use> </svg> </span></aside>'}function showAppContent(e){document.getElementById("app").style.opacity=.1,document.getElementById("app").innerHTML=e;let t=.5,n=setInterval(function(){t<1?((t+=.1)>=1&&(t=1),document.getElementById("app").style.opacity=t):clearInterval(n)},100);window.scrollTo(0,0)}function getPublic(){fetch("/app/public",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status&&(showAppContent(e.template),tabReflash(),refreshFsLightbox(),setfsLightboxProps(),loadPostCardVideo(),AOS.refresh(),window.history.pushState("","","/"),document.title="Tranquility")})}function getCalendar(){fetch("/app/calendar",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{if(200===e.status){showAppContent(e.template),getCalendarEvents(),tabReflash(),activeWorldClock();let t=setInterval(()=>{document.getElementById("clock")?document.getElementById("clock").innerHTML=moment().format("H:mm:ss"):clearInterval(t)},1e3);window.history.pushState("","","/calendar"),document.title="Calendar | Tranquility"}})}function activeWorldClock(){document.querySelectorAll("[data-timezone]").forEach(e=>{let t=setInterval(()=>{e?e.querySelector("span").innerHTML=moment().tz(e.dataset.timezone).format("H:mm:ss"):clearInterval(t)},1e3)})}function getMe(){fetch("/app/me",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status&&(showAppContent(e.template),tabReflash(),refreshFsLightbox(),setfsLightboxProps(),loadPostCardVideo(),AOS.refresh(),window.history.pushState("","","/me"),document.title="Me | Tranquility")})}function getTube(){fetch("/app/tube",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status&&(showAppContent(e.template),tabReflash(),disableVideoControl(),preventVideoRightClick(),videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.dispose()),window.history.pushState("","","/watch"),document.title="Watch | Tranquility")})}function getChannelApp(){let e=arguments[0]||getParameterByName("uid");e&&fetch("/app/channel",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({channel:e})}).then(e=>e.json()).then(t=>{200===t.status&&(showAppContent(t.template),tabReflash(),disableVideoControl(),preventVideoRightClick(),videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.dispose()),window.history.pushState("","",`/channel?uid=${e}`))})}"serviceWorker"in navigator&&webNotificationSend().catch(e=>{});let getRelatedNews=e=>{e&&fetch("/news/related",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})}).then(e=>e.json()).then(e=>{lozad(".lozad",{rootMargin:"300px 0px",threshold:.1,enableAutoReload:!0}).observe(),200===e.status&&(document.getElementById("news-related-result").innerHTML=e.template),AOS.refresh()})};function getNews(){var e=window.location.pathname.split("/");let t=getParameterByName("uid")||e[2],n=getParameterByName("q");fetch("/app/news",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:t,query:n})}).then(e=>e.json()).then(e=>{200===e.status&&(showAppContent(e.template),getWeather(),new Progressive({el:"body",lazyClass:"progressive-img",removePreview:!0,scale:!1}).fire(),t?(window.history.pushState("","",`/news?uid=${t}`),getRelatedNews(t)):n?window.history.pushState("","",`/news?q=${n}`):window.history.pushState("","","/news"),document.title="News | Tranquility")})}function getSetting(){document.body.click(),fetch("/app/setting",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status?(showAppContent(e.template),tabReflash(),AOS.refresh(),window.history.pushState("","","/setting"),document.title="Setting | Tranquility"):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})}function getParameterByName(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");let n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function getSearch(){let e;13===(event.which||event.keyCode)?(e=event.currentTarget.value,event.preventDefault(),event.currentTarget.blur(),showAppLoading()):e=getParameterByName("q"),e&&fetch("/search",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({query:e})}).then(e=>e.json()).then(t=>{200===t.status?(showAppContent(t.template),tabReflash(),refreshFsLightbox(),setfsLightboxProps(),loadPostCardVideo(),AOS.refresh(),window.history.pushState("","",`/search?q=${e}`)):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})})}function getUserPage(){let e=event.currentTarget.dataset.user;e&&(showAppLoading(),fetch(`/getUser?uid=${e}`,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status?(showAppContent(e.template),tabReflash(),refreshFsLightbox(),setfsLightboxProps(),loadPostCardVideo(),AOS.refresh()):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}function getGroup(){let e=arguments[0]?arguments[0]:event.currentTarget.dataset.group;e&&(showAppLoading(),fetch(`/getGroup?uid=${e}`,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(t=>{200===t.status?(showAppContent(t.template),tabReflash(),refreshFsLightbox(),setfsLightboxProps(),tableReflash(),loadPostCardVideo(),AOS.refresh(),window.history.pushState("","",`/group?uid=${e}`)):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}function getAlbum(){if($STATE.isGuest)toast({type:"error",title:`${i18next.t("Please login to continue")}`});else{let e=arguments[0]?arguments[0]:event.currentTarget.dataset.album,t=arguments[1]?arguments[1]:event.currentTarget.dataset.category;e&&t&&(showAppLoading(),fetch("/app/album",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({album:e,category:t})}).then(e=>e.json()).then(n=>{200===n.status?(showAppContent(n.template),refreshFsLightbox(),setfsLightboxProps(),AOS.refresh(),window.history.pushState("","",`/album?uid=${e}&category=${t}`)):toast({type:"error",title:`${i18next.t("Something went wrong!")}`})}))}}function loadPostCardVideo(){try{if("IntersectionObserver"in window){const e=document,t=Array(100).fill().map((e,t)=>.01*t),n=new IntersectionObserver((e,t)=>{e.forEach(e=>{const{intersectionRatio:t,target:n}=e;t>0?n.querySelectorAll("video").forEach(e=>{e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2||e.play()}):n.querySelectorAll("video").forEach(e=>{let t=e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2;!e.paused&&t&&e.pause()})})},{root:e,threshold:t}),o=document.querySelectorAll(".PostCard");for(const e of o)n.observe(e)}}catch(e){}}function notificationSound(){if($STATE.user.property.notificationSoundAlert){let e;e=["cloud","glisten","polite","sharp","taptap"].includes($STATE.user.property.notificationSound)?$STATE.user.property.notificationSound:"cloud";let t=new Audio(`/T-Source/audio/${e}.wav`);t.volume=.5,t.play()}}function download(e,t){let n=document.createElement("a");n.style="display: none",n.setAttribute("href",URL.createObjectURL(e)),n.setAttribute("download","TQ Meet"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function focusSearchInput(){document.getElementById("search").focus()}function getWeather(){null===localStorage.getItem("fahrenheit")&&localStorage.setItem("fahrenheit",!1);let e={location:"",sunrise:void 0,sunset:void 0,now:{temp:0,weather:""},forecast:[{temp:0,weather:"",hour:""},{temp:0,weather:"",hour:""},{temp:0,weather:"",hour:""},{temp:0,weather:"",hour:""},{temp:0,weather:"",hour:""}]};const t={"01d":"clear-day.svg","01n":"clear-night.svg","02d":"partly-cloudy-day.svg","02n":"partly-cloudy-night.svg","03d":"cloudy.svg","03n":"cloudy.svg","04d":"overcast.svg","04n":"overcast.svg","09d":"partly-cloudy-day-rain.svg","09n":"partly-cloudy-night-rain.svg","10d":"partly-cloudy-day-rain.svg","10n":"partly-cloudy-night-rain.svg","11d":"thunderstorms-day.svg","11n":"thunderstorms-night.svg","13d":"partly-cloudy-day-snow.svg","13n":"partly-cloudy-night-snow.svg","50d":"mist.svg","50n":"mist.svg"};const n=e=>e>=12?(12===e?e:e-12)+"PM":(0===e?12:e)+"AM";((e={})=>new Promise(function(t,n){if(navigator.geolocation)return navigator.geolocation.getCurrentPosition(t,n,e);n()}))().then(o=>{((e,t)=>fetch(((e,t)=>`https://api.openweathermap.org/data/2.5/weather?lat=${e}&lon=${t}&units=metric&appid=fc9c2f0009a8329f2ac436eca2267b63`)(e,t)).then(e=>e.json()))(o.coords.latitude,o.coords.longitude).then(a=>(function(t){const n=new Date(1e3*t.sys.sunrise).getHours()<(new Date).getHours()&&(new Date).getHours()<new Date(1e3*t.sys.sunset).getHours();e={...e,location:t.name,isDay:n,now:{temp:t.main.temp,weather:t.weather[0].icon,wind:t.wind.speed,humidity:t.main.humidity}}})(a)|((e,t)=>fetch(((e,t)=>`https://api.openweathermap.org/data/2.5/forecast?lat=${e}&lon=${t}&units=metric&appid=fc9c2f0009a8329f2ac436eca2267b63`)(e,t)).then(e=>e.json()))(o.coords.latitude,o.coords.longitude).then(t=>(t=>{t.list.every(({main:{temp:t},weather:[{icon:o}],dt_txt:a},r)=>(e.forecast[r]={temp:t,weather:o,hour:n(new Date(a).getHours())},r<e.forecast.length-1))})(t)).then(()=>void(document.getElementById("widget-weather").innerHTML=`\n            <img src="https://cdn.jsdelivr.net/gh/TranquilityTech/tq-weather-icons@1.0.0/production/line/all/${t[e.now.weather]}" alt="">\n            <span>${e.now.temp}</span>\n            <i class="fas fa-tint"></i>\n            <span>${e.now.humidity}</span>\n            <i class="fas fa-wind"></i>\n            <span>${e.now.wind}</span>\n        `)))})}function discover(){let e=document.querySelector(".main-container");e.classList.remove("show"),e.scrollIntoView=e.scrollHeight,document.querySelector(".vid-container .sidebar").style.cssText="width: 220px; margin: 0 .3em; padding: .5em; visibility: visible;",document.getElementById("close-video").style.cssText="visibility: hidden;",videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.reset()),window.scrollTo(0,0),window.history.pushState("","","/watch")}function getVideoInfo(e){fetch("/video/info",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include",body:JSON.stringify({uid:e})}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("video-info").innerHTML=e.template)})}function getVideoRelated(){fetch("/video/related",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json","CSRF-Token":$STATE.csrfToken},credentials:"include"}).then(e=>e.json()).then(e=>{200===e.status&&(document.getElementById("video-related").innerHTML=e.template)})}function showVideo(){event.preventDefault(),document.querySelector(".main-container").classList.add("show"),document.querySelector(".vid-container .sidebar").style.cssText="width: 0; margin: 0; padding: 0; visibility: hidden;",document.getElementById("close-video").style.cssText="visibility: visible;",window.scrollTo(0,0);let e=arguments[0]?arguments[0]:event.currentTarget.dataset.video;if(e){let t=videojs("video");t.src({type:"video/mp4",src:`/v?category=Trantube&uid=${e}`}),t.play(),window.history.pushState("","",`/watch?uid=${e}`);let n='\n            <div class="video-related-preloader">\n                <div class="square"></div>\n                <div class="line-wrapper">\n                    <div class="line"></div>\n                    <div class="line"></div>\n                </div>\n            </div>\n        ';document.getElementById("video-related").innerHTML=`\n            <aside class="chat-vid__container">\n                <div class="chat-vid__title">Related Videos</div>\n                ${n.repeat(6)}\n            </aside>\n        `,document.getElementById("video-info").innerHTML='\n            <div id="video-intro-preloader">\n                <div class="square"></div>\n                <div class="line-wrapper">\n                    <div class="line"></div>\n                </div>\n\n                <div class="desc-wrapper">\n                    <div class="line"></div>\n                    <div class="line"></div>\n                </div>\n            </div>\n        ',disableVideoControl(),getVideoInfo(e),getVideoRelated()}}"object"!=typeof window.CP&&(window.CP={}),window.CP.PenTimer={programNoLongerBeingMonitored:!1,timeOfFirstCallToShouldStopLoop:0,_loopExits:{},_loopTimers:{},START_MONITORING_AFTER:2e3,STOP_ALL_MONITORING_TIMEOUT:5e3,MAX_TIME_IN_LOOP_WO_EXIT:2200,exitedLoop:function(e){this._loopExits[e]=!0},shouldStopLoop:function(e){if(this.programKilledSoStopMonitoring)return!0;if(this.programNoLongerBeingMonitored)return!1;if(this._loopExits[e])return!1;let t=this._getTime();if(0===this.timeOfFirstCallToShouldStopLoop)return this.timeOfFirstCallToShouldStopLoop=t,!1;let n=t-this.timeOfFirstCallToShouldStopLoop;if(n<this.START_MONITORING_AFTER)return!1;if(n>this.STOP_ALL_MONITORING_TIMEOUT)return this.programNoLongerBeingMonitored=!0,!1;try{this._checkOnInfiniteLoop(e,t)}catch(e){return this._sendErrorMessageToEditor(),this.programKilledSoStopMonitoring=!0,!0}return!1},_sendErrorMessageToEditor:function(){try{if(this._shouldPostMessage()){let e={action:"infinite-loop",line:this._findAroundLineNumber()};parent.postMessage(JSON.stringify(e),"*")}else this._throwAnErrorToStopPen()}catch(e){this._throwAnErrorToStopPen()}},_shouldPostMessage:function(){return document.location.href.match(/boomerang/)},_throwAnErrorToStopPen:function(){throw"Infinite loop"},_findAroundLineNumber:function(){let e=new Error,t=0;if(e.stack){let n=e.stack.match(/boomerang\S+:(\d+):\d+/);n&&(t=n[1])}return t},_checkOnInfiniteLoop:function(e,t){if(!this._loopTimers[e])return this._loopTimers[e]=t,!1;if(t-this._loopTimers[e]>this.MAX_TIME_IN_LOOP_WO_EXIT)throw"Infinite Loop"+e},_getTime:function(){return+new Date}},window.CP.shouldStopExecution=function(e){let t=window.CP.PenTimer.shouldStopLoop(e);return!0===t&&console.warn("Time out"),t},window.CP.exitedLoop=function(e){window.CP.PenTimer.exitedLoop(e)};let playerTrackerColor={metal:{50:"#868975",80:"#36372F"}};const buttons={shuffle:document.querySelector("#controls .shuffle"),previous:document.querySelector("#controls .previous"),playPause:document.querySelector("#controls .play-pause"),next:document.querySelector("#controls .next"),repeat:document.querySelector("#controls .repeat")},songCurrentTime=document.querySelector(".song-current-time"),songLength=document.querySelector(".song-length"),trackingSlider=document.querySelector(".tracking-slider"),volumeSlider=document.querySelector(".volume-slider"),playlistBody=document.querySelector("#playlist tbody");let playlistPlay=document.querySelectorAll("#playlist .play-pause"),listItems=document.querySelectorAll("#playlist tbdoy tr");const audio=document.getElementById("player");function toggleClasses(e,t){const n=new Set(e.classList),o="string"==typeof t||t instanceof String?t.split(" "):t;for(const t of o){if(window.CP.shouldStopExecution(1))break;n.has(t)?e.classList.remove(t):e.classList.add(t)}window.CP.exitedLoop(1)}function toggleBoolean(e){return!e}function secondsToHms(e){return e>3600?moment(1e3*e).format("HH:mm:ss"):moment(1e3*e).format("mm:ss")}class Player{constructor(){this.playing=new Set(buttons.playPause.classList).has("on"),this.shuffle=new Set(buttons.shuffle.classList).has("on"),this.repeat=new Set(buttons.repeat.classList).has("on"),this.songIndex=0,this.previousSong=playList.length-1,this.song=playList[this.songIndex],this.randomOrder=new Set,this.randomIndex=0,this.volume=.8}updateSong(e){this.previousSong=this.songIndex,this.songIndex=e||this.songIndex,this.song=playList[this.songIndex];const t=this.song;audio.src=`${t.url}`,trackingSlider.value=0,this.updateSongRangeValues(),songLength.innerHTML=secondsToHms(t.duration),trackingSlider.max=t.duration,document.querySelector(`tr[data-index="${this.previousSong}"]`).classList.remove("playing"),toggleClasses(document.querySelector(`tr[data-index="${this.songIndex}"]`),"playing")}play(){audio.play(),videoChatBGM()}pause(){audio.pause(),videoChatBGM()}seek(){audio.currentTime=Number(trackingSlider.value),songCurrentTime.innerHTML=secondsToHms(audio.currentTime)}updateSongRangeValues(){const e=trackingSlider.value/this.song.duration*100;songCurrentTime.innerHTML=secondsToHms(trackingSlider.value),trackingSlider.style.background=`linear-gradient(to right, var(--theme-color) 0%, var(--theme-color) ${e}%, ${playerTrackerColor.metal[50]} ${e}%, ${playerTrackerColor.metal[50]} 0%, ${playerTrackerColor.metal[80]} 0%, ${playerTrackerColor.metal[80]} 100%)`}adjustVolume(){const{value:e}=volumeSlider;audio.volume=e,volumeSlider.style.background=`linear-gradient(to right, var(--theme-color) 0%, var(--theme-color) ${100*e}%, ${playerTrackerColor.metal[50]} ${100*e}%, ${playerTrackerColor.metal[50]} 0%, ${playerTrackerColor.metal[80]} 0%, ${playerTrackerColor.metal[80]} 100%)`}}class PlayerControls extends Player{playPause(){this.playing=toggleBoolean(this.playing),toggleClasses(buttons.playPause,"on fa-play fa-pause"),new Set(buttons.playPause.classList).has("on")?this.play():this.pause(),this.showPlayingIcon()}showPlayingIcon(){new Set(buttons.playPause.classList).has("on")?document.querySelectorAll("#msg-friend-list li")[0].querySelector(".menuIcon i").classList.replace("fa-bell","fa-music"):document.querySelectorAll("#msg-friend-list li")[0].querySelector(".menuIcon i").classList.replace("fa-music","fa-bell")}next(){this.previousSong=this.songIndex;let e=!0;toggleClasses(document.querySelector(`tr[data-index="${this.songIndex}"]`),"playing"),this.shuffle?(this.randomIndex++,this.randomIndex>=this.randomOrder.size&&(this.randomIndex=0,e=this.repeat),this.songIndex=Array.from(this.randomOrder)[this.randomIndex]):(this.songIndex++,this.songIndex>=playList.length&&(this.songIndex=0,e=this.repeat)),this.updateSong(),this.playing&&(e?this.play():this.playPause())}previous(){toggleClasses(document.querySelector(`tr[data-index="${this.songIndex}"]`),"playing"),this.shuffle?(0===this.randomIndex&&(this.randomIndex=this.randomOrder.size),this.randomIndex--,this.songIndex=Array.from(this.randomOrder)[this.randomIndex]):(0===this.songIndex&&(this.songIndex=playList.length),this.songIndex--),this.updateSong(),this.playing&&this.play()}toggleShuffle(){if(this.shuffle=toggleBoolean(this.shuffle),toggleClasses(buttons.shuffle,"on"),new Set(buttons.shuffle.classList).has("on")){this.randomOrder=new Set,this.randomIndex=0;let e=this.songIndex;for(let t=0;t<playList.length&&!window.CP.shouldStopExecution(3);t++){for(;this.randomOrder.has(e)&&!window.CP.shouldStopExecution(2);)e=Math.floor(Math.random()*playList.length);window.CP.exitedLoop(2),this.randomOrder.add(e)}window.CP.exitedLoop(3)}}toggleRepeat(){this.repeat=toggleBoolean(this.repeat),toggleClasses(buttons.repeat,"on")}}function buildPlaylist(){let e="";for(let t=0;t<playList.length;t++)e+=`\n            <tr data-index="${t}">\n                <td class="play-pause"><img src="${playList[t].avatar}" onerror="imageNotFound()"></td>\n                <td>${playList[t].title}</td>\n                <td>${playList[t].artist}</td>\n                <td>${secondsToHms(playList[t].duration)}</td>\n            </tr>\n        `;playlistBody.innerHTML=e,listItems=document.querySelectorAll("#playlist tbody tr"),playlistPlay=document.querySelectorAll("#playlist .play-pause");for(const e of listItems){if(window.CP.shouldStopExecution(4))break;e.addEventListener("click",e=>{const t=e.target.parentElement.dataset.index;controls.updateSong(t),controls.playing&&controls.play()}),e.addEventListener("dblclick",e=>{e.preventDefault(),e.stopPropagation(),controls.playing||controls.playPause()})}window.CP.exitedLoop(4);for(const e of playlistPlay){if(window.CP.shouldStopExecution(5))break;e.addEventListener("click",e=>{controls.playing||controls.playPause()})}window.CP.exitedLoop(5)}let controls;if(!$STATE.isGuest){var playList=[{title:"TQ AI Music 1",avatar:"/T-Source/image/webp/tq-music.webp",artist:"Tranquility",url:"/m?id=1",duration:40.704},{title:"TQ AI Music 2",avatar:"/T-Source/image/webp/tq-music.webp",artist:"Tranquility",url:"/m?id=2",duration:46.446},{title:"TQ AI Music 3",avatar:"/T-Source/image/webp/tq-music.webp",artist:"Tranquility",url:"/m?id=3",duration:25.809}];controls=new PlayerControls,buildPlaylist(),controls.updateSong(),controls.adjustVolume(),buttons.playPause.addEventListener("click",()=>controls.playPause()),buttons.next.addEventListener("click",()=>controls.next()),buttons.previous.addEventListener("click",()=>controls.previous()),buttons.shuffle.addEventListener("click",()=>controls.toggleShuffle()),buttons.repeat.addEventListener("click",()=>controls.toggleRepeat()),audio.onended=(()=>{controls.next()}),audio.ontimeupdate=(()=>{trackingSlider.value=audio.currentTime,controls.updateSongRangeValues()}),trackingSlider.addEventListener("change",()=>{controls.updateSongRangeValues(),controls.seek()}),trackingSlider.addEventListener("mousemove",()=>controls.updateSongRangeValues()),volumeSlider.addEventListener("change",()=>controls.adjustVolume()),volumeSlider.addEventListener("mousemove",()=>controls.adjustVolume())}function router(e){switch(tabReflash(),window.location.pathname.split("/")[1]){case"":$STATE.isGuest||getPublic(),document.querySelector('[data-url="public"]')&&document.querySelector('[data-url="public"]').classList.add("selected");break;case"calendar":getCalendar(),document.querySelector('[data-url="calendar"]').classList.add("selected");break;case"me":getMe(),document.querySelector('[data-url="me"]').classList.add("selected");break;case"news":getNews(),document.querySelector('[data-url="news"]').classList.add("selected");break;case"search":getSearch();break;case"group":getGroup(getParameterByName("uid"));break;case"album":getAlbum(getParameterByName("uid"),getParameterByName("category"));break;case"setting":getSetting();break;case"watch":videojs.getAllPlayers().length>0&&videojs.getAllPlayers().forEach((e,t)=>e.dispose()),getParameterByName("uid")?getVideo(getParameterByName("uid")):getTube(),$STATE.isGuest||document.querySelector('[data-url="watch"]').classList.add("selected");break;case"channel":getChannelApp(),document.querySelector('[data-url="watch"]').classList.add("selected")}window.scrollTo(0,0)}if(window.addEventListener("load",e=>router(e)),window.addEventListener("popstate",e=>router(e)),window.addEventListener("online",e=>{toast({type:"info",title:"Recontected"})}),window.addEventListener("offline",e=>{toast({type:"info",title:"Disconnected"})}),document.addEventListener("click",e=>{document.querySelectorAll(".comment .options, .PostCard .options, .content-wrapper .options, .MusicCard .options, tbody .options, .album-container .options, .ContactCard .options, .EventCard .options").forEach(e=>{let t=e.querySelector('input[type="checkbox"]');!e.contains(event.target)&&t.checked&&(t.checked=!1)}),document.querySelectorAll(".date-picker").forEach(e=>{!e.contains(event.target)&&e.querySelector(".dates").classList.contains("active")&&e.querySelector(".dates").classList.remove("active")})},!1),document.addEventListener("keyup",()=>{"27"==event.which&&(document.querySelectorAll(".popupCover").forEach(e=>e.classList.remove("active")),document.querySelector("#search").blur(),closeMessenger())}),document.getElementById("nav-setting")){let e,t=0,n=5,o=document.getElementById("nav-bar").offsetHeight;function hasScrolled(){let e=document.documentElement.scrollTop;Math.abs(t-e)<=n||(e>t&&e>o?document.getElementById("nav-bar").classList.add("hidden"):e+window.innerHeight<document.documentElement.offsetHeight&&document.getElementById("nav-bar").classList.remove("hidden"),t=e)}if(window.onscroll=function(t){e=!0},setInterval(()=>{e&&(hasScrolled(),e=!1)},200),document.querySelector("#nav-setting").addEventListener("click",()=>{document.querySelector("#nav-setting-toolbox").classList.toggle("hidden")}),document.addEventListener("click",e=>{const t=document.getElementById("nav-setting-toolbox");let n=e.target,o=document.getElementById("nav-setting");do{if(n==t||n==o)return;n=n.parentNode}while(n);document.querySelector("#nav-setting-toolbox").classList.add("hidden")}),document.querySelector("#nav-bar .nav-tabs")){let e=document.querySelector("#nav-bar .nav-logo"),t=document.querySelector("#nav-bar #nav-setting"),n=document.querySelector("#nav-bar .search-container");function hideNavIconIfHasTabs(n){n.matches?(e.classList.add("hidden"),t.classList.add("hidden")):(e.classList.remove("hidden"),t.classList.remove("hidden"))}let o=window.matchMedia("(max-width: 650px)");function hideNavSearchIfHasTabs(e){e.matches?n.classList.add("hidden"):n.classList.remove("hidden")}hideNavIconIfHasTabs(o),o.addListener(hideNavIconIfHasTabs);let a=window.matchMedia("(max-width: 1280px)");hideNavSearchIfHasTabs(a),a.addListener(hideNavSearchIfHasTabs)}}let mouseTimer=null,cursorVisible=!0;function disappearCursor(){$STATE.user.property.hideCursorWhenIdle&&(mouseTimer=null,document.body.style.cursor="none",cursorVisible=!1)}function checkForm(){return event.currentTarget.submit.disabled=!0,!0}function activeSearch(){event.currentTarget.closest(".search-bar").focus(),event.currentTarget.closest(".search-container").classList.add("active"),document.querySelector("#searchBarForm").classList.add("active")}function inactiveSearch(){event.currentTarget.closest(".search-container").classList.remove("active"),document.querySelector("#searchBarForm").classList.remove("active")}function autocomplete(e,t){let n;function o(e){if(!e)return!1;!function(e){for(let t=0;t<e.length;t++)e[t].classList.remove("search-inner-container-active")}(e),n>=e.length&&(n=0),n<0&&(n=e.length-1),e[n].classList.add("search-inner-container-active")}function a(t){let n=document.getElementsByClassName("search-inner-container-items");for(let o=0;o<n.length;o++)t!=n[o]&&t!=e&&n[o].parentNode.removeChild(n[o])}e.addEventListener("input",function(o){let r,i,s,c=this.value;if(a(),!c)return!1;for(n=-1,(r=document.createElement("DIV")).setAttribute("id",this.id+"search-inner-container-list"),r.setAttribute("class","search-inner-container-items"),this.parentNode.appendChild(r),s=0;s<t.length;s++)t[s].substr(0,c.length).toUpperCase()==c.toUpperCase()&&((i=document.createElement("DIV")).innerHTML="<strong>"+t[s].substr(0,c.length)+"</strong>",i.innerHTML+=t[s].substr(c.length),i.innerHTML+="<input type='hidden' value='"+t[s]+"' onkeyup='getSearch()'>",i.addEventListener("click",function(t){e.value=this.getElementsByTagName("input")[0].value,a()}),r.appendChild(i))}),e.addEventListener("keydown",function(e){let t=document.getElementById(this.id+"search-inner-container-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(n++,o(t)):38==e.keyCode?(n--,o(t)):13==e.keyCode&&(e.preventDefault(),n>-1&&t&&t[n].click())}),document.addEventListener("click",e=>{a(e.target)})}document.onmousemove=function(){mouseTimer&&window.clearTimeout(mouseTimer),cursorVisible||(document.body.style.cursor="default",cursorVisible=!0),mouseTimer=window.setTimeout(disappearCursor,1e3)};let searchList=[];document.getElementById("search")&&autocomplete(document.getElementById("search"),searchList);let supportedLanguages=["af","am","ar","az","be","bg","bn","bs","ca","ceb","co","cs","cy","da","de","el","en","eo","es","et","eu","fa","fi","fr","fy","ga","gd","gl","gu","ha","haw","hi","hmn","hr","ht","hu","hy","id","ig","is","it","iw","ja","jw","ka","kk","km","kn","ko","ku","ky","la","lb","lo","lt","lv","mg","mi","mk","ml","mn","mr","ms","mt","my","ne","nl","no","ny","pl","ps","pt","ro","ru","sd","si","sk","sl","sm","sn","so","sq","sr","st","su","sv","sw","ta","te","tg","th","tl","tr","uk","ur","uz","vi","xh","yi","yo","zh","zh-TW","zu"],userLanguage=supportedLanguages.includes(`${$STATE.user.language}`)?`${$STATE.user.language}`:"en";fetch(`https://cdn.jsdelivr.net/gh/TranquilityTech/tqi18n@1.0.1/${userLanguage}/translation.json`).then(e=>e.json()).then(e=>{i18next.init({lng:`${userLanguage}`,resources:{userLanguage:{translation:e}}})}).catch(e=>console.error(e)),document.addEventListener("paste",()=>{event.preventDefault();let e=(event.clipboardData||window.clipboardData).getData("text");document.execCommand("insertText",!1,e)});const observer=lozad(".lozad",{rootMargin:"300px 0px",threshold:.1,enableAutoReload:!0});observer.observe(),AOS.init();var PageTitleNotification={vars:{OriginalTitle:document.title,Interval:null},on:function(e,t){let n=this;n.vars.Interval=setInterval(function(){document.title=n.vars.OriginalTitle==document.title?e:n.vars.OriginalTitle},t||1e3)},off:function(){clearInterval(this.vars.Interval),document.title=this.vars.OriginalTitle}};